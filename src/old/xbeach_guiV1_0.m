function xbeach_gui(varargin)
clear all;clc
global handles figurehandleX cor pos fh kt MB_phy handles_MB MB_out UISAVE...
    UISAVEAS directory direc_place
% persistent tab_sed_transp tab_morphoUP
warning off;
% set(0,'DefaultAxesFontName', 'Consolas');
% set(0,'DefaultTextFontname', 'Consolas')

opengl('software');
import java.awt.*;
import java.awt.event.*;
import javax.swing.*
JFrame.setDefaultLookAndFeelDecorated(true); %java
kt=7;
% -                           SPLASH SCREEN
%--------------------------------------------------------------------------
% fh = figure('Visible','off','MenuBar','none','NumberTitle','off');
% modifyLogo(fh); ah = axes('Parent',fh,'Visible','off');
% splashPHOTO=imread('\\cpebrazilfs01\Apps\applications\CPE_tools\XBEACH_GUI\logos\xbeach_splash.png');
% ih = image(splashPHOTO,'parent',ah);
% imxpos = get(ih,'XData'); imypos = get(ih,'YData');
% set(ah,'Unit','Normalized','Position',[0,0,1,1]);
% figpos = get(fh,'Position'); figpos(3:4) = [imxpos(2) imypos(2)];
% set(fh,'Position',figpos); movegui(fh,'center'); axis off;
% set(fh,'Visible','on');
% ht = timer('StartDelay',1,'ExecutionMode','SingleShot','TimerFcn',@splashXbeach,...
%     'Name','Splash');
% start(ht);  pause(1);


for k=1:kt
    for g=1:9
        handles{g,k}=[];
    end
end
vertMargin = 0;
oldRootUnits = get(0,'Units');
% Restore the Units safely
c = onCleanup(@()set(0, 'Units', oldRootUnits));
set(0, 'Units', 'points');
screenSize = get(0,'ScreenSize');
delete(c);
% axFontSize=get(0,'FactoryAxesFontSize');
axFontSize=6;
set(0,'ScreenPixelsPerInch',96);
pointsPerPixel = 72/get(0,'ScreenPixelsPerInch');
width = 800 * pointsPerPixel;
height = 600 * pointsPerPixel;
pos = [screenSize(3)/2-width/2 screenSize(4)/2-height/2 width height];
% pos = [screenSize(3)-width/1.5-5 35 width/1.5 height];
axNorm=[.05 .1 .6 .1];
%     axPos=axNorm.*[pos(3:4),pos(3:4)] + [0 vertMargin 0 -2];
axPos=[width/4 59 width*0.4 9];

% Create a figure
cor=[0.9 0.9 0.9];
directory=pwd;
figurehandleX = figure('Units', 'points','BusyAction','queue','WindowStyle','normal', ...
    'Position',pos,'Resize','off','CreateFcn','','NumberTitle','off', ...
    'IntegerHandle','off','MenuBar','none','Tag','XbeachGUI','Interruptible','off', ...
    'DockControls','off','Visible','on','Interruptible','off','name',...
    ['XBeach GUI  --  ',fsize(directory),'*'],'color',cor);
f=uimenu(figurehandleX,'label','File');
uimenu(f,'label','New','callback',@newFile00,'enable','on');
OPEN_PARAMS=uimenu(f,'label','Open','callback',@openfile,'enable','on');
UISAVE=uimenu(f,'label','Save','callback',@savefile,'enable','off');
UISAVEAS=uimenu(f,'label','Save As','callback',@saveasfile,'enable','off','separator','on');
uimenu(f,'label','Exit','callback',@myclosereq);
vM=uimenu(figurehandleX,'label','View');
uimenu(vM,'label','Visualization Area','callback',@viewarea);
aboutM=uimenu(figurehandleX,'label','Help');
uimenu(aboutM,'label','About','callback',@aboutXbeachGUI);

set(figurehandleX, 'CloseRequestFcn', @myclosereq);
setappdata(figurehandleX,'figurehandle',figurehandleX);

% change
modifyLogo(figurehandleX)

% plot initial data
MB_tf=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Time Frame','fontsize',10,'fontw','bold',...
    'position',[10 height-30 110 20],'callback',@timeframe_button);
MB_dom=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Domain','fontsize',10,'fontw','bold',...
    'position',[10 height-55 110 20],'callback',@domain_button);
MB_proc=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Processes','fontsize',10,'fontw','bold',...
    'position',[10 height-80 110 20],'callback',@processes_button);
MB_lim=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Limiters','fontsize',10,'fontw','bold',...
    'position',[10 height-105 110 20],'callback',@limiters_button);
MB_phy=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Physical Parameters','enable','off','fontsize',10,'fontw','bold',...
    'position',[10 height-130 110 20],'callback',@phy_parameters_button);
MB_bound=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Boundaries','fontsize',10,'fontw','bold',...
    'position',[10 height-155 110 20],'callback',@boundaries_button);
MB_drifters=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Drifters','fontsize',10,'fontw','bold',...
    'position',[10 height-180 110 20],'callback',@drifters_button,'enable','off');
MB_monit=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Monitoring','fontsize',10,'fontw','bold',...
    'position',[10 height-205 110 20],'callback',@monitoring_button,'enable','off');
MB_out=uicontrol('units','points','parent',figurehandleX,'style','pushbutton',...
    'string','Output','fontsize',10,'fontw','bold','enable','off',...
    'position',[10 height-230 110 20],'callback',@output_button);
handles_MB=[MB_tf MB_dom MB_proc MB_lim MB_phy MB_bound MB_drifters MB_monit MB_out];
%     Disable access to the handle
set(figurehandleX, 'HandleVisibility', 'callback')

direc_icon=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\FolderOpen.png');
for i=1:size(direc_icon,1)
    for j=1:size(direc_icon,2)
        if direc_icon(i,j,:)==0 | direc_icon(i,j,:)<100
            direc_icon(i,j,:)=255*0.9;
        end
    end
end
direc_text=uicontrol('parent',figurehandleX,'unit','normalized','style','text',...
    'string','Select Directory','position',[0.01 0.005 0.13 0.027],...
    'fontsize',9,'fontw','bold','backgroundcolor',cor);
direc_place=uicontrol('parent',figurehandleX,'unit','normalized','style','edit',...
    'string',pwd,'position',[0.14 0.003 0.81 0.034],'fontw','normal',...
    'fontsize',8,'backgroundcolor',[1 1 1],'horizontalalignment','center');
direc_dir=uicontrol('parent',figurehandleX,'unit','normalized','style','pushbutton',...
    'cdata',direc_icon,'position',[0.96 0.005 0.028 0.033],...
    'callback',@select_directory);

function select_directory(varargin)
global figurehandleX direc_place
fig=getappdata(figurehandleX,'figurehandle');
path=uigetdir(pwd,'Select Directory');
if path~=0
    set(direc_place,'string',path);
    set(figurehandleX,'name',['XBeach GUI  --  ',fsize(path),'*']);
    cd(path)
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                            File Menu - Save                            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function savefile(varargin)
global handles figurehandleX cor fh figureSAVEfilesX params0 directory...
    tstop CFL...
    gridform xyfile depfile thetamin  thetamax dtheta  ...
    hmin eps umin hwci...
    gravity_value rho...
    cf C nuh nuhfac nuhv smag zs0file tideloc...
    wavint wci gamma gammax alpha n roller beta...
    rhoa Cd windv windth...
    z0 facsl BRfac rhos	por tsfac facua...
    morfac morstart wetslp dryslp hswitch...
    bcfile...
    thetanaut...
    scheme break_value...
    waveform form thetanum smax...
    morfacopt sourcesink...
    fbound1_Pop fbound1_PopCon...
    fbound2_Pop fbound2_PopCon...
    instat...
    outputformat...
    swave lwave flow sedtrans morphology nonh gwflow q3d...
    lws sws...
    outGlob_CB outTimeAvg_CB outPoint_CB... %variables types
    outGlobAll_CB outGlobZb_CB outGlobZs_CB...
    outGlobH_CB outGlobEu_CB outGlobthMean_CB outGlobsedero_CB outGlobdzav_CB... 
    outGlobsusg_CB outGlobsvsg_CB outGlobsubg_CB outGlobsvbg_CB... global
    outTavgAll_CB outTavgbH_CB outTavgEu_CB... 
    outTavgsusg_CB outTavgsvsg_CB outTavgsubg_CB outTavgsvbg_CB...time-averaged
    outPointAll_CB outPointzs_CB outPointH_CB outPointEu_CB...
    tstart tintg tintm tintp
vin=varargin;
if ~isempty(vin) & ischar(vin{1})
    save_directory=vin{1};
else
    save_directory=pwd; save_directory=[save_directory,'\params.txt'];
end

% try
    fig=getappdata(figurehandleX,'figurehandle');
    set(0, 'Units', 'points'); screenSize = get(0,'ScreenSize');
    width=250; height=150; un=20;
    pos = [screenSize(3)/2-width/0.4 screenSize(4)/2-height/2 width 0];
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%% edit variables %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    auxE1={tstop;CFL}; keyE1={'tstop';'CFL'}; defaultE1={1000;0.7};
    %if Delft3DForm  - INCOMPLETE - TO REVISE (XBEACH FORM)
    auxE2={gridform; xyfile; depfile; thetamin; thetamax; dtheta; };
    keyE2={'gridform';'xyfile';'depfile';'thetamin';'thetamax';'dtheta'}; defaultE2={'delft3d';'';'';0;270;20};
    auxE3=[]; keyE3=[]; defaultE3=[];
    auxE4={hmin; eps; umin; hwci}; %limiters tab
    keyE4={'hmin';'eps';'umin';'hwci'}; defaultE4={0.05; 0.005; 0.0; 0.1};
    auxE5={gravity_value; rho; ...%constant tab
        cf; C; nuh; nuhfac; nuhv; smag; zs0file; tideloc;...%flow tab
        wavint; wci; gamma; gammax; alpha; n; roller; beta;...%wave tab
        rhoa; Cd; windv; windth;...%wind tab
        z0; facsl; BRfac; rhos;	por; tsfac; facua;...% sed_trans tab
        morfac; morstart; wetslp; dryslp; hswitch}; %morpho tab
    keyE5={'g';'rho';'cf';'C';'nuh';'nuhfac';'nuhv';'smag'; 'zs0file'; 'tideloc';...
        'wavint';'wci';'gamma';'gammax';'alpha';'n';'roller';'beta';...
        'rhoa';'Cd';'windv';'windth';...
        'z0';'facsl';'BRfac';'rhos';'por';'tsfac';'facua';...
        'morfac';'morstart';'wetslp';'dryslp';'hswitch'};
    defaultE5={9.81; 1025; 0.003; sqrt(9.81/0.003); 0.15; 0; 1; 1; '';'';...
        1; 0; 0.55; 2; 1; 10; 1; 0.15;...
        1.25; 0.002; 5; 0;...
        0.006; 0; 1; 2650; 0.4; 0.1; 0;...
        1; 120; 0.3; 1; 0.1};
    auxE6={bcfile}; keyE6={'bcfile'}; defaultE6={'jonswap'};%wave boundary
    auxE7=[]; keyE7=[]; defaultE7=[];
    auxE8=[]; keyE8=[]; defaultE8=[];
    auxE9={tstart; tintg; tintm; tintp};
    keyE9={'tstart';'tintg';'tintm';'tintp'}; 
    defaultE9={'0';'60';'3600';'2'};
    for j=1:9
        eval(['var1=auxE',num2str(j),';']); eval(['var2=keyE',num2str(j),';']);
        eval(['var3=defaultE',num2str(j),';']);
        for i=1:33
            if ~isempty(var1)
                if i <= size(var1,1)
                    variable_handles_Edit{i,j}=var1{i,1};
                    keywordsE{i,j}=var2{i,1};
                    defaultEdit{i,j}=var3{i,1};
                else
                    variable_handles_Edit{i,j}=[];
                    keywordsE{i,j}=[];
                    defaultEdit{i,j}=[];
                end
            else
                variable_handles_Edit{i,j}=[];
                keywordsE{i,j}=[];
                defaultEdit{i,j}=[];
            end
        end
        clear var1 var2 var3
    end
    
    %%%%%%%%%%%%%%%%%%%%%%%%%% pop-up variables %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    auxPOP1=[]; keyPOP1=[]; defaultPOP1=[];
    auxPOP2={thetanaut}; keyPOP2={'thetanaut'}; defaultPOP2={0}; % ATTENTION %grid
    auxPOP3=[]; keyPOP3=[]; defaultPOP3=[];
    auxPOP4=[]; keyPOP4=[]; defaultPOP4=[];
    auxPOP5={scheme; break_value;...%wave tab
        waveform; form; thetanum; smax;...%sed_transport tab
        morfacopt; sourcesink}; %morpho tab
    keyPOP5={'scheme';'break';...
        'waveform';'form';'thetanum';'smax';...
        'morfacopt';'sourcesink'};
    defaultPOP5={2; 3;...
        'vanthiel'; 1; 1; 1; ...
        2; 1};
    auxPOP6={instat;'0.5';...
        fbound1_PopCon;...%flow boundary 1
        fbound2_PopCon}; %flow boundary2
    % wave boundary
    axB1=get(fbound1_Pop,'string'); axB2=get(fbound1_PopCon,'string');
    axB3=get(fbound2_Pop,'string'); axB4=get(fbound2_PopCon,'string');
    keyPOP6={'instat';'dtbc'; ...
        axB1(get(fbound1_Pop,'value'),1:end);... %axB2(get(fbound1_PopCon,'value'),1:end);...
        axB3(get(fbound2_Pop,'value'),1:end)}; %axB4(get(fbound2_PopCon,'value'),1:end)};
    % ??????? %%%%%%%%%%%%%%%     ATTENTION     %%%%%%%%%%%%%%%
    defaultPOP6={6; 0.5;...
        'abs_1d';...
        'wall'}; % ATTENTION
    auxPOP7=[]; keyPOP7=[]; defaultPOP7=[];
    auxPOP8=[]; keyPOP8=[]; defaultPOP8=[];
    auxPOP9={outputformat}; keyPOP9={'outputformat'}; defaultPOP9={2};
    for j=1:9
        eval(['var1=auxPOP',num2str(j),';']); eval(['var2=keyPOP',num2str(j),';']);
        eval(['var3=defaultPOP',num2str(j),';']);
        for i=1:8
            if ~isempty(var1)
                if i <= size(var1,1)
                    variable_handles_Pop{i,j}=var1{i,1};
                    keywordsPop{i,j}=var2{i,1};
                    defaultPOPUP{i,j}=var3{i,1};
                else
                    variable_handles_Pop{i,j}=[];
                    keywordsPop{i,j}=[];
                    defaultPOPUP{i,j}=[];
                end
            else
                variable_handles_Pop{i,j}=[];
                keywordsPop{i,j}=[];
                defaultPOPUP{i,j}=[];
            end
        end
        clear var1 var2 var3
    end
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%% check box variables %%%%%%%%%%%%%%%%%%%%%%%%%
    auxC1=[]; keyC1=[]; defaultC1=[];
    auxC2={swave; lwave; flow; sedtrans; morphology; nonh; gwflow; q3d}; %processes
    keyC2={'swave'; 'lwave'; 'flow'; 'sedtrans'; 'morphology'; 'nonh'; 'gwflow'; 'q3d'};
    defaultC2={1; 1; 1; 1; 1; 0; 0; 0};
    auxC3=[]; keyC3=[]; defaultC3=[];
    auxC4=[]; keyC4=[]; defaultC4=[];
    auxC5={lws;sws}; keyC5={'lws';'sws'}; defaultC5={1; 1};%sed_trans
    auxC6=[]; keyC6=[]; defaultC6=[];
    auxC7=[]; keyC7=[]; defaultC7=[];
    auxC8=[]; keyC8=[]; defaultC8=[];
    auxC9={outGlob_CB; ... %OUTPUT - variables types - INCOMPLETE
        outGlobAll_CB; outGlobZb_CB; outGlobZs_CB;...
        outGlobH_CB; outGlobEu_CB; outGlobthMean_CB; outGlobsedero_CB; outGlobdzav_CB;...
        outGlobsusg_CB; outGlobsvsg_CB; outGlobsubg_CB; outGlobsvbg_CB;... global
        outTimeAvg_CB; outTavgAll_CB; outTavgbH_CB; outTavgEu_CB;... 
        outTavgsusg_CB; outTavgsvsg_CB; outTavgsubg_CB; outTavgsvbg_CB;... time-averaged
        outPoint_CB; outPointAll_CB; outPointzs_CB; outPointH_CB; outPointEu_CB};%point
    keyC9={'nglobalvar'; ...
        'XbeachGlobal';'zb';'zs';'H';'ue';'thetamean';'sedero';'dzav';'Susg';'Svsg';'Subg';'Svbg';...
        'nmeanvar'; 'XbeachTime'; 'H'; 'ue';'Susg';'Svsg';'Subg';'Svbg';...
        'npoints'; 'XbeachPoint'; 'zs';'H';'ue'}; % ATTENTION
    defaultC9={1; ...
        ''; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1; 1;...
        1;''; 1; 1; 1; 1; 1; 1;...
        1;''; 1; 1; 1}; % ATTENTION
    for j=1:9
        eval(['var1=auxC',num2str(j),';']); eval(['var2=keyC',num2str(j),';']);
        eval(['var3=defaultC',num2str(j),';']);
        for i=1:size(var1,1)
            if ~isempty(var1)
                if i <= size(var1,1)
                    variable_handles_Check{i,j}=var1{i,1};
                    keywordsCheck{i,j}=var2{i,1};
                    defaultCHECK{i,j}=var3{i,1};
                else
                    variable_handles_Check{i,j}=[];
                    keywordsCheck{i,j}=[];
                    defaultCHECK{i,j}=[];
                end
            else
                variable_handles_Check{i,j}=[];
                keywordsCheck{i,j}=[];
                defaultCHECK{i,j}=[];
            end
        end
        clear var1 var2 var3
    end
    
    %organizing params.txt file
    L=1;
    for col=1:9
        for f=1:3
            if f==1; name=keywordsE; elseif f==2; name=keywordsPop; elseif f==3; name=keywordsCheck; end
            for lin=1:size(name,1);
                if ~isempty(name{lin,col})
                    if f==1 % Edit
                        if col==2 & lin==1
                            params0{L,1}=name{lin,col}; params0{L,2}=variable_handles_Edit{lin,col};
                        elseif col==5 & lin==9
                            if strcmpi(get(variable_handles_Edit{lin,col},'string'),'Filename Unknown')==0
                                params0{L,1}=name{lin,col}; params0{L,2}=get(variable_handles_Edit{lin,col},'string');
                            else
                                continue
                            end
                        elseif col==5 & lin==10
                            if strcmpi(get(variable_handles_Edit{lin-1,col},'string'),'Filename Unknown')==1
                                continue
                            else
                                params0{L,1}=name{lin,col}; params0{L,2}=get(variable_handles_Edit{lin,col},'string');
                            end
                        else
                            if ~isempty(get(variable_handles_Edit{lin,col},'string'))
                                params0{L,1}=name{lin,col}; params0{L,2}=get(variable_handles_Edit{lin,col},'string');
                            else
                                params0{L,1}=name{lin,col}; params0{L,2}=defaultEdit{lin,col};
                            end
                        end
                    elseif f==2 % PopUpMenu
                        if col==6 & lin==2
                            params0{L,1}=name{lin,col}; params0{L,2}=variable_handles_Pop{lin,col};
                        else
                            if ~isempty(get(variable_handles_Pop{lin,col},'string'))
                                params0{L,1}=name{lin,col};
                                if col==5 & lin==7 | lin==8 || col==2 & lin==1
                                    params0{L,2}=get(variable_handles_Pop{lin,col},'value') - 1;
                                elseif col==5 & lin==3
                                    aux01=get(variable_handles_Pop{lin,col},'string');
                                    params0{L,2}=aux01(get(variable_handles_Pop{lin,col},'value'),1:end);
                                elseif col==5 & lin==4
                                    aux01=get(variable_handles_Pop{lin,col},'string');
                                    if strcmp(aux01([1:2:32]),'Soulsby\vanRijn ');
                                        params0{L,2}=1;
                                    elseif strcmp(aux01([2:2:32]),'Vanthiel\vanRijn');
                                        params0{L,2}=2;
                                    end
                                elseif col==5 & lin==5
                                    params0{L,2}=get(variable_handles_Pop{lin,col},'value') - 0.5;
                                elseif col==5 & lin==6 %col==6 & lin==1
                                    params0{L,2}=get(variable_handles_Pop{lin,col},'value') - 2;
                                elseif col==6 & lin==1
                                    aux01=get(variable_handles_Pop{lin,col},'value') - 2;
                                    if aux01==4; params0{L,2}='jons'; else params0{L,2}=aux01; end
                                elseif col==6 & lin==3 | lin==4
                                    aux01=get(variable_handles_Pop{lin,col},'string');
                                    params0{L,2}=aux01(get(variable_handles_Pop{lin,col},'value'),1:end);
                                else
                                    params0{L,2}=get(variable_handles_Pop{lin,col},'value');
                                end
                            else
                                params0{L,1}=name{lin,col}; params0{L,2}=defaultPOPUP{lin,col};
                            end
                        end
                    elseif f==3 % CheckBox
                        if ~isempty(get(variable_handles_Check{lin,col},'value'))
                            params0{L,1}=name{lin,col}; params0{L,2}=get(variable_handles_Check{lin,col},'value');
                        else
                            params0{L,1}=name{lin,col}; params0{L,2}=defaultCHECK{lin,col};
                        end
                    end
                    L=L+1;
                end
            end
        end
    end
    
    %write params.txt file
    clear params vector spaces
    l01=idx_finder(params0,'gridform',1); l02=idx_finder(params0,'swave',1); l03=idx_finder(params0,'hmin',1);
    l05=idx_finder(params0,'cf',1); l066=idx_finder(params0,'zs0file',1); l06=idx_finder(params0,'wavint',1);
    l07=idx_finder(params0,'rhoa',1); l08=idx_finder(params0,'z0',1); l09=find(ismember(params0(:,1),'morfac'));
    l10=idx_finder(params0,'bcfile',1); l11=idx_finder(params0,'front',1); l12=idx_finder(params0,'outputformat',1);
    l044=idx_finder(params0,'hwci',1); l04=l044+1;
    if isempty(l066)
        l066=l06;
    end
    
    if strcmp(get(variable_handles_Edit{9,5},'string'),'Filename Unknown')==1 
        handles_name={'Time Frame Parameters';'Domain Parameters';...
            'Processes Parameters'; 'Limiters Parameters';...
            'Constants Parameters'; 'Flow Parameters';...
            'Wave Parameters'; 'Wind Parameters';...
            'Sediment Transport Parameters'; 'Morphological Parameters';...
            'Wave Boundaries Parameters'; 'Flow Boundaries Parameters';...
            'Output Configuration'}; IDX02=13;
            spaces=[1 l01 l02 l03 l04 l05 l06 l07 l08 l09 l10 l11 l12 81]; i=1; % modify this vector if add some
    else
        handles_name={'Time Frame Parameters';'Domain Parameters';...
            'Processes Parameters'; 'Limiters Parameters';...
            'Constants Parameters'; 'Flow Parameters';'Tide/Surge Parameters';...
            'Wave Parameters'; 'Wind Parameters';...
            'Sediment Transport Parameters'; 'Morphological Parameters';...
            'Wave Boundaries Parameters'; 'Flow Boundaries Parameters';...
            'Output Configuration'}; IDX02=14;
            spaces=[1 l01 l02 l03 l04 l05 l066 l06 l07 l08 l09 l10 l11 l12 81]; i=1; % modify this vector if add some
    end
    
    % keywords in params.txt
    for g=1:size(spaces,2)-1;
        if g==1
            params{i,1}=dispSection('');
            params{i+1,1}=dispSection('                                          ');
            params{i+2,1}=dispSection('   XBeach parameter settings input file   ');
            params{i+3,1}=dispSection('    Generated in XBeach GUI by GHG v1.0   ');
            params{i+4,1}=dispSection(['        Date: ',sprintf(datestr(clock)),'        ']);
            params{i+5,1}=dispSection('                                          '); i=i+7;
        end
        if g==size(spaces,2)-1
            i=i+1;
        end
        params{i,1}=dispSection(handles_name{g,1}); i=i+1;
        
        % output variables
        if strfind(params0{spaces(g),1},'outputformat')==1
            %         idxOUT=find_index('outputformat');
            aux=strfind(params0(:,1),'outputformat');
            for p=1:size(aux,1);
                if aux{p,1}==1
                    idxOUT=p;
                end
            end
            Vec=[idxOUT idxOUT+14 idxOUT+14]; D1=[1 0 0]; H1=[1 0 0];
            for Q=1:2 % INCOMPLETE - ATTENTION FOR POINT OUTPUT (Q = 3)
                clear vector
                idxOUT=Vec(Q);
                if params0{idxOUT,2}==2 % netcdf
                    params{i,1}=[params0{idxOUT,1},' = netcdf'];
                    params{i+1,1}=[params0{idxOUT-4,1},' = ',params0{idxOUT-4,2}];
                    params{i+2,1}=[params0{idxOUT-3,1},' = ',params0{idxOUT-3,2}];
                    params{i+3,1}=[params0{idxOUT-2,1},' = ',params0{idxOUT-2,2}];
                    i=i+5;
                end
                if params0{idxOUT+D1(Q),2}==1; cont=0; % save global variables
                    if Q==1
                        ax1=idxOUT+3; ax2=idxOUT+13;
                    elseif Q==2
                        ax1=idxOUT+2; ax2=idxOUT+7;
                    elseif Q==3
                        ax1=idxOUT+2; ax2=idxOUT+4;
                    end
                    for j= ax1 : ax2;
                        if params0{j,2}==1;
                            cont=cont+1;
                            vector(cont,1)=j;
                        end;
                    end
                    if exist('vector','var')
                        params{i,1}=[params0{idxOUT+H1(Q),1},' = ',num2str(cont)]; bACK=i; i=i+1;
                        for o=1:size(vector,1)
                            if strfind(params0{vector(o,1),1},'ue')==1
                                params{bACK,1}=[params0{idxOUT+H1(Q),1},' = ',num2str(cont+1)];
                                params{i,1}='ue'; params{i+1,1}='ve'; i=i+2;
                            else
                                params{i,1}=params0{vector(o,1),1}; i=i+1;
                            end
                            if o==length(vector); i=i+1; end
                        end
                    end
                end
            end
        end
        
        if g<IDX02
            if g==IDX02 - 1
                k1=spaces(g); k2=spaces(g+1) - 5;
            else
                k1=spaces(g); k2=spaces(g+1) - 1;
            end
            for k=k1 : k2
                %         aux99=string_converter(params0{k,2});
                aux98=params0{k,2};
                if ischar(aux98);
                    aux99=aux98;
                elseif iscell(aux98);
                    aux99=aux98{1};
                elseif isnumeric(aux98)
                    aux99=num2str(aux98);
                end
                params{i,1}=[params0{k,1},' = ',aux99];
                if k == spaces(g+1)-1
                    i=i+2;
                else
                    i=i+1;
                end
            end
        end
    end
    fid=fopen(save_directory,'w');
    for g=1:size(params,1)
        fprintf(fid,'%s\n',params{g,1});
    end
    fclose(fid);
    fclose all;
    set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd)]);
% catch
%     alertFigure('Error saving params.txt file!');
% end

function [idx]=idx_finder(structF,carac,col)
aux=strfind(structF(:,col),carac); i=1;
for g=1:size(aux,1)
    if aux{g,1}==1
        idx(i)=g; i=i+1;
    end
end
if ~exist('idx','var')
    idx=[];
end

function saveasfile(varargin)
[fileSas,pathSas] = uiputfile('params.txt','Save file name');
if fileSas~=0
    save_directory=[pathSas,fileSas];
    savefile(save_directory);
end


% First check - Main Button's handles
% z=1;
% for g=1:size(handles,1)
%     aux=0;
%     for k=1:size(handles,2)
%         if isempty(handles{g,k});
%             aux=aux+1;
%         end
%     end
%     if aux==7
%         verify(z,1)=g; z=z+1;
%     end
% end
% if ~isempty(verify)
%     if size(verify,1)==1; pos=pos+[0 0 0 0];
%     elseif size(verify,1)==2; pos=pos+[0 0 0 un*1];
%     elseif size(verify,1)==3; pos=pos+[0 0 0 un*2];
%     elseif size(verify,1)==4; pos=pos+[0 0 0 un*3];
%     elseif size(verify,1)==5; pos=pos+[0 0 0 un*4];
%     elseif size(verify,1)==6; pos=pos+[0 0 0 un*5];
%     elseif size(verify,1)==7; pos=pos+[0 0 0 un*6];
%     elseif size(verify,1)==8; pos=pos+[0 0 0 un*7];
%     elseif size(verify,1)==9; pos=pos+[0 0 0 un*8];
%     end
%
%     figureSAVEfilesX = dialog('units','points','Name','XBeach GUI - Save "params.txt"','position',pos,...
%     'color',cor); modifyLogo(figureSAVEfilesX);
%     remember01=uicontrol('units','normalized','parent',figureSAVEfilesX,'style','text',...
%     'string','You need to set more Buttons ','fontsize',10,'fontw','bold',...
%     'position',[.1 .90 .8 .2],'backgroundcolor',cor);
%
% %     for g=1:size(verify,1)
% end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                            File Menu - Open                            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function openfile(varargin)
global handles kt figurehandleX  A...
    d3ddepPB_open d3ddepUn_edit d3ddepUn_edit1 u0 u1...
    d3dthetaMINT  d3dthetaMINT2 d3dthetaMAXT ...
    d3dthetaMAXT2 d3d_dthetaT  d3d_dthetaT2 d3d_theNautT1 d3dclock bathyclock...
    tide_handle tide_panelPB tide_panelPB1 tide_panel wfile_open handles_Glob handles_Tavg...
    output_Globpanel output_Tavgpanel handles_MB gridparclock gr_xbstylePB gr_d3dstylePB...
    tstop CFL...
    gridform xyfile depfile thetamin  thetamax dtheta  ...
    hmin eps umin hwci...
    gravity_value rho...
    cf C nuh nuhfac nuhv smag zs0file tideloc...
    wavint wci gamma gammax alpha n roller beta...
    rhoa Cd windv windth...
    z0 facsl BRfac rhos	por tsfac facua...
    morfac morstart wetslp dryslp hswitch...
    bcfile...
    thetanaut...
    scheme break_value...
    waveform form thetanum smax...
    morfacopt sourcesink...
    fbound1_Pop fbound1_PopCon...
    fbound2_Pop fbound2_PopCon...
    instat...
    outputformat...
    swave lwave flow sedtrans morphology nonh gwflow q3d...
    lws sws...
    outGlob_CB outTimeAvg_CB outPoint_CB... %variables types
    outGlobAll_CB outGlobZb_CB outGlobZs_CB...
    outGlobH_CB outGlobEu_CB outGlobthMean_CB outGlobsedero_CB outGlobdzav_CB... global
    outGlobsusg_CB outGlobsvsg_CB outGlobsubg_CB outGlobsvbg_CB ...
    outTavgAll_CB outTavgbH_CB outTavgEu_CB... 
    outTavgsusg_CB outTavgsvsg_CB outTavgsubg_CB outTavgsvbg_CB...time-averaged
    outPointAll_CB outPointzs_CB outPointH_CB outPointEu_CB...
    tstart tintg tintm tintp...
    handles_G

try
    [file,path]=uigetfile({'*.txt','params (*.txt)'},'Open Params File');
    if file~=0
        fid=fopen([path,file],'r');
        reading=fread(fid,'*char'); reading=strread(reading,'%s','whitespace','\b');
        aux_perc=strfind(reading(:,1),'%'); z=1; clear reading_org;
        idxEND=idx_finder(reading,'nglobalvar',1);
        if isempty(idxEND); idxEND = size(aux_perc,1); end
        % Read params file until declared output variables
        for g=1 : idxEND
            if isempty(aux_perc{g,1})
                clear aux01; aux01=strfind(reading{g,1},'=');
                if ~isempty(aux01)
                    reading_org{z,1}=reading{g,1}(1:aux01-1); reading_org{z,2}=reading{g,1}(aux01+1:end); z=z+1;
                else
                    alertFigure(sprintf(['Bad Params File!\nMissing ''='' signal in line ',num2str(g)]));
                    a=fclose(fid);
                    break
                end
            end
        end
        
        
        l01=idx_finder(reading_org,'gridform',1); l02=idx_finder(reading_org,'swave',1);
        l03=idx_finder(reading_org,'hmin',1); l04=idx_finder(reading_org,'g',1);
        l05=idx_finder(reading_org,'cf',1); l066=idx_finder(reading_org,'zs0file',1);
        l06=idx_finder(reading_org,'wavint',1); l07=idx_finder(reading_org,'rhoa',1);
        l08=idx_finder(reading_org,'z0',1); l09=idx_finder(reading_org,'morfac ',1);
        l10=idx_finder(reading_org,'bcfile',1); l11=idx_finder(reading_org,'front',1);
        l12=idx_finder(reading_org,'outputformat',1); l13=idx_finder(reading_org,'break',1);
        
        
        if isempty(l066)
            spaces=[1 l01 l01 l02 l03 22 l05 l06 l07 l08 l09 l10 l11 l12 81]; % modify this vector if add some
            functions_handles={'timeframe_button';'d3dstyle_grid';'bathymetry';...
                'processes_button';'limiters_button';'constantsTAB';'flowTAB';...
                'waveTAB';'windTAB';'sedtranspTAB';'morphoTAB';'wave_bound';...
                'flow_bound';'output_button'};
            stringB=[1 2 4:8 18:52 65 71:73];
            checkB=[10:17 63 64];
            popB=[9 55:62 66 68:70];
        else
            spaces=[1 l01 l01 l02 l03 22 l05 l066 l06 l07 l08 l09 l10 l11 l12 81];
            functions_handles={'timeframe_button';'d3dstyle_grid';'bathymetry';...
                'processes_button';'limiters_button';'constantsTAB';'flowTAB';'flowTAB';...
                'waveTAB';'windTAB';'sedtranspTAB';'morphoTAB';'wave_bound';...
                'flow_bound';'output_button'};
            stringB=[1 2 4:8 18:54 65 71:73];
            checkB=[10:17 63 64];
            popB=[9 55:62 66 68:70];
        end
        for j=1:size(spaces,2) - 1
            if j~=3
                if j~=2
                    lim1=spaces(j); lim2=spaces(j+1) - 1;
                else
                    lim1=spaces(j); lim2=spaces(j+2) - 1;
                end
                %         if j==
                eval(functions_handles{j,1});
                for h= lim1 : lim2
                    if any((stringB-h)==0)
                        if h==22
                            set(gravity_value,'string',reading_org{h,2});
                        else
                            set(eval(reading_org{h,1}),'string',reading_org{h,2}(2:end));
                        end
                    elseif any((checkB-h)==0)
                        set(eval(reading_org{h,1}),'value',str2double(reading_org{h,2}));
                    elseif any((popB-h)==0)
                        if strcmp(reading_org{h,1}(1:end-1),'thetanaut') | strcmp(reading_org{h,1}(1:end-1),'morfacopt') | ...
                                strcmp(reading_org{h,1}(1:end-1),'sourcesink')
                            set(eval(reading_org{h,1}),'value',str2double(reading_org{h,2}) + 1);
                        elseif strcmp(reading_org{h,1}(1:end-1),'waveform') %5%3
                            if strcmp(reading_org{h,2}(2:end),'ruessink')
                                set(eval(reading_org{h,1}),'value',1);
                            elseif strcmp(reading_org{h,2}(2:end),'vanthiel')
                                set(eval(reading_org{h,1}),'value',2);
                            end
                        elseif strcmp(reading_org{h,1}(1:end-1),'form')
                            set(eval(reading_org{h,1}),'value',str2double(reading_org{h,2}));
                        elseif strcmp(reading_org{h,1}(1:end-1),'thetanum')
                            if str2double(reading_org{h,2}) == 0.5
                                set(eval(reading_org{h,1}),'value',str2double(reading_org{h,2}) + 0.5);
                            else
                                set(eval(reading_org{h,1}),'value',str2double(reading_org{h,2}));
                            end
                        elseif strcmp(reading_org{h,1}(1:end-1),'smax') %5%6
                            set(eval(reading_org{h,1}),'value',str2double(reading_org{h,2}) + 2);
                        elseif strcmp(reading_org{h,1}(1:end-1),'instat') %6%1 %wave boundaries
                            if strcmp(reading_org{h,2}(2:end),'jons') | str2double(reading_org{h,2})==4
                                set(eval(reading_org{h,1}),'value',6);
                            elseif reading_org{h,2}==41
                                set(eval(reading_org{h,1}),'value',13);
                            end
                            % lines unit elseif 'back' you can simplify easily and
                            % insert missing wave bounds
                        elseif strcmp(reading_org{h,1}(1:end-1),'front')
                            if h==68; hand=fbound1_PopCon; elseif h==69; hand=fbound2_PopCon; end;
                            clear bounds aux01; bounds={'none','abs_1d','abs_2d','wall','wlevel','nonh_1d'};
                            aux01=strcmp(bounds,reading_org{h,2}(2:end));
                            set(hand,'value',find(aux01==1));
                        elseif strcmp(reading_org{h,1}(1:end-1),'back')
                            if h==68; hand=fbound1_PopCon; elseif h==69; hand=fbound2_PopCon; end;
                            clear bounds aux01; bounds={'none','wall','abs_1d','abs_2d','wlevel'};
                            aux01=strcmp(bounds,reading_org{h,2}(2:end));
                            set(hand,'value',find(aux01==1));
                        elseif strcmp(reading_org{h,1}(1:end-1),'outputformat')
                            if strcmp(reading_org{h,2}(2:end),'netcdf')
                                set(eval(reading_org{h,1}),'value',2);
                            else
                                set(eval(reading_org{h,1}),'value',1);
                            end
                        elseif h==l13
                            set(break_value,'value',str2double(reading_org{h,2}));
                        end
                    end
                end
            else
                idx000=idx_finder(reading_org,'depfile',1);
                A=1;
                domain_button
                eval(functions_handles{j,1});
                set(d3ddepPB_open,'enable','on')
                set(d3ddepUn_edit,'enable','off');
                set(d3ddepUn_edit1,'enable','off');
                set(depfile,'enable','on');
                set(u0,'value',1); set(u1,'value',0);
                if ~isempty(reading_org{idx000,2})
                    set(eval(reading_org{idx000,1}),'string',reading_org{idx000,2}(2:end));
                else
                    set(eval(reading_org{idx000,1}),'string','Filename Unknown');
                end
            end
            
            % active organizing
            if strcmp(functions_handles{j,1},'d3dstyle_grid')
                handles_grid=[d3dthetaMINT thetamin d3dthetaMINT2 d3dthetaMAXT thetamax...
                    d3dthetaMAXT2 d3d_dthetaT dtheta d3d_dthetaT2 d3d_theNautT1 thetanaut];
                set(handles_grid,'enable','on');
            elseif j==8 & strcmp(functions_handles{j,1},'flowTAB')
                set(tide_handle,'enable','on');
                set(tide_panelPB1,'visible','on','value',0);
                set(tide_panel,'foregroundcolor','k');
                set(tide_panelPB,'visible','off','value',0);
            elseif strcmp(functions_handles{j,1},'wave_bound')
                set([wfile_open bcfile],'enable','on');
            end
        end
        
        % Read params file of declared output variables
        ls00=idx_finder(reading_org,'tstart',1); ls01=idx_finder(reading_org,'tintg',1);
        ls02=idx_finder(reading_org,'tintm',1); ls03=idx_finder(reading_org,'tintp',1);
        ls04=idx_finder(reading,'nglobalvar',1);
        ls05=idx_finder(reading,'zb',1); ls06=idx_finder(reading,'zs',1);
        ls07=idx_finder(reading,'H',1); ls08=idx_finder(reading,'ue',1);
        ls09=idx_finder(reading,'ve',1); ls10=idx_finder(reading,'thetamean',1);
        ls11=idx_finder(reading,'sedero',1); ls12=idx_finder(reading,'dzav',1);
        ls13=idx_finder(reading,'nmeanvar',1); ls14=idx_finder(reading,'Susg',1);
        ls15=idx_finder(reading,'Svsg',1); ls16=idx_finder(reading,'Subg',1);
        ls17=idx_finder(reading,'Svbg',1);
        if numel(ls06)~=2 & ls06<85
            ls06(2)=ls06;
        end
        vectorS=[ls00 ls01 ls02 ls03 ls04 ls05 ls06(2) ls07 ls08 ls09 ls10 ls11 ls12 ls13...
            ls14 ls15 ls16 ls17];
        set([handles_Glob handles_Tavg],'value',0);
        for b=1:size(vectorS,2)
            if ~isempty(ls00) & vectorS(b)==ls00
                set(tstart,'string',reading_org{ls00,2});
            elseif ~isempty(ls01) & vectorS(b)==ls01
                set(tintg,'string',reading_org{ls01,2});
            elseif ~isempty(ls02) & vectorS(b)==ls02
                set(tintm,'string',reading_org{ls02,2});
            elseif ~isempty(ls03) & vectorS(b)==ls03
                set(tintp,'string',reading_org{ls03,2});
            elseif ~isempty(ls04) & vectorS(b)==ls04
                set(outGlob_CB,'value',1);
                set(handles_Glob,'enable','on');
                set(output_Globpanel,'foregroundcolor','k');
            elseif ~isempty(ls05) & vectorS(b)==ls05
                set(outGlobZb_CB,'value',1);
            elseif ~isempty(ls06) & b == find(vectorS==ls06(2))
                if size(ls06,2)==1 & ls06>85
                    set(outGlobZs_CB,'value',1);
                elseif size(ls06,2) > 1 & ls06(2) > 85
                    set(outGlobZs_CB,'value',1);
                end
            elseif ~isempty(ls07) & b == find(vectorS==ls07(1))
                if size(ls07,2)>1 & ~isempty(ls04) & ~isempty(ls13)
                    if ls07(1) > ls04 & ls07(1) < ls13
                        set(outGlobH_CB,'value',1);
                    end
                    if ls07(2) > ls13
                        set(outTavgbH_CB,'value',1);
                    end
                elseif size(ls07,2)==1 & ~isempty(ls04) & ~isempty(ls13)
                    if ls07 > ls04 & ls07 < ls13
                        set(outGlobH_CB,'value',1);
                    elseif ls07 > ls13
                        set(outTavgbH_CB,'value',1);
                    end
                end
            elseif ~isempty(ls08) & ~isempty(ls09) & b == find(vectorS==ls08(1))
                if size(ls08,2) > 1 & size(ls09,2) > 1 & ~isempty(ls04) & ~isempty(ls13)
                    if ls08(1) > ls04 & ls08(1) < ls13
                        set(outGlobEu_CB,'value',1);
                    end
                    if ls08(2) > ls13
                        set(outTavgEu_CB,'value',1);
                    end
                elseif size(ls08,2)==1 & size(ls09,2)==1 & ~isempty(ls04) & ~isempty(ls13)
                    if ls08 > ls04 & ls08 < ls13
                        set(outGlobEu_CB,'value',1);
                    elseif ls08 > ls13
                        set(outTavgEu_CB,'value',1);
                    end
                end
            elseif ~isempty(ls10) & vectorS(b)==ls10
                set(outGlobthMean_CB,'value',1);
            elseif ~isempty(ls11) & vectorS(b)==ls11
                set(outGlobsedero_CB,'value',1);
            elseif ~isempty(ls12) & vectorS(b)==ls12
                set(outGlobdzav_CB,'value',1);
            elseif ~isempty(ls14) & vectorS(b)==ls14 %susg
                if size(ls14,2) == 2
                    set([outGlobsusg_CB,outTavgsusg_CB],'value',1);
                elseif size(ls14,2)==1 & ls14 > ls13
                    set(outTavgsusg_CB,'value',1);
                else
                    set(outGlobsusg_CB,'value',1);
                end
            elseif ~isempty(ls15) & vectorS(b)==ls15 %svsg
                if size(ls15,2) == 2
                    set([outGlobsvsg_CB,outTavgsvsg_CB],'value',1);
                elseif size(ls15,2)==1 & ls15 > ls13
                    set(outTavgsvsg_CB,'value',1);
                else
                    set(outGlobsvsg_CB,'value',1);
                end
            elseif ~isempty(ls16) & vectorS(b)==ls16 %subg
                if size(ls16,2) == 2
                    set([outGlobsubg_CB,outTavgsubg_CB],'value',1);
                elseif size(ls16,2)==1 & ls16 > ls13
                    set(outTavgsubg_CB,'value',1);
                else
                    set(outGlobsubg_CB,'value',1);
                end
            elseif ~isempty(ls17) & vectorS(b)==ls17 %svbg
                if size(ls17,2) == 2
                    set([outGlobsvbg_CB,outTavgsvbg_CB],'value',1);
                elseif size(ls17,2)==1 & ls17 > ls13
                    set(outTavgsvbg_CB,'value',1);
                else
                    set(outGlobsvbg_CB,'value',1);
                end
            elseif ~isempty(ls13) & vectorS(b)==ls13
                set(outTimeAvg_CB,'value',1);
                set(handles_Tavg,'enable','on');
                set(output_Tavgpanel,'foregroundcolor','k');
            elseif isempty([ls05 ls06 ls07 ls08 ls09 ls10 ls11 ls12])
                set([outGlobAll_CB outGlobZb_CB outGlobZs_CB outGlobH_CB outGlobEu_CB ...
                    outGlobthMean_CB  outGlobsedero_CB  outGlobdzav_CB],'value',0);
                set(outGlobAll_CB,'value',1);
                set([outTavgAll_CB outTavgbH_CB outTavgEu_CB],'value',0);
                set(outTavgAll_CB,'value',1);
            end
            
        end
        
        % set all main button to black "series"
        set(handles_MB,'foregroundcolor','k');
        
        % close params file
        fclose(fid);
        fclose all;
        
        % d3dclock
        d3dclock=datenum(clock); gridparclock=datenum(clock);
        gridsParameters;
        set(handles_G,'foregroundcolor','k'); set(handles_G(1),'foregroundcolor','b');
        set(gr_xbstylePB,'foregroundcolor','k'); set(gr_d3dstylePB,'foregroundcolor','b');
        
        for k=1:kt
            for g=1:length(handles(:,1))
                if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
            end
        end
        
    end
catch
    alertFigure('Error opening params.txt file!');
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                          UIMENU New                        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function newFile00(varargin)
global handles saveFYes saveFNo saveF
for i=1:size(handles,1)
    for j=1:size(handles,2)
        if ~isempty(handles{i,j})
            notisempty=1;
        end
    end
end
if exist('notisempty','var')
        width=250; height=100; set(0, 'Units', 'points'); screenSize=get(0,'screensize');
    pos1 = [screenSize(3)/2-width/2 screenSize(4)/2-height/2 width height];
    saveF=figure('unit','points','BusyAction','queue','WindowStyle','modal', ...
        'Position',pos1,'Resize','off','CreateFcn','','NumberTitle','off', ...
        'IntegerHandle','off','MenuBar','none','Tag','XbeachGUI','Interruptible','off', ...
        'DockControls','off','Visible','on','Interruptible','off','color',[1 1 1],'name','Xbeach GUI');
    saveFIcon=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\Alert.png','backgroundcolor',[1 1 1]);
    saveFIconF=uicontrol('unit','normalized','cdata',saveFIcon,...
        'position',[0.07 0.25 0.2 0.52]);
    saveFTXT=uicontrol('unit','normalized','style','text',...
        'string',sprintf('Params file have been changed!\nSave params file?'),'position',[0.32 0.5 0.63 0.3],...
        'fontsize',10,'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','center');
    saveFYes=uicontrol('unit','normalized','style','pushbutton',...
        'string','Yes','position',[0.435 0.15 0.2 0.2],...
        'fontsize',10,'fontw','bold','callback',@newFile);
    saveFNo=uicontrol('unit','normalized','style','pushbutton',...
        'string','No','position',[0.665 0.15 0.2 0.2],...
        'fontsize',10,'fontw','bold','callback',@newFile);
    modifyLogo(saveF)
end
% uiresume(saveF);

function newFile(hObj,varargin)
global handles handles_MB xbclock d3dclock bathyclock gridparclock ...
constantsclock flowclock waveclock windclock...
    sedtranspclock morphoclock flow_bound_clock wave_bound_clock...
    saveFYes saveFNo kt saveF A
if hObj == saveFYes
    savefile;
end
set(handles_MB,'foregroundcolor','k');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
% clear([xbclock d3dclock bathyclock gridparclock ...
% constantsclock flowclock waveclock windclock...
%     sedtranspclock morphoclock flow_bound_clock wave_bound_clock]);
clear -global -regexp \w*clock\w*

clearvars -global A
for k=1:kt
    for g=1:9
        handles{g,k}=[];
    end
end
clear functions
set([handles_MB(5) handles_MB(7) handles_MB(8) handles_MB(9)],'enable','off');
close(saveF);


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                          Main Button Time Frame                        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function timeframe_button(varargin)
global handles figurehandleX cor kt handles_MB MB_out tstop CFL globalhand; %if ~isempty('vars1'); delete(vars1); end
globalhand{1,1}={tstop;CFL};
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles_MB,'foregroundcolor','k'); set(handles_MB(1),'foregroundcolor','b');
set(MB_out,'enable','on');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{1,1},'visible','on');
if isempty(handles{1,1})
    fig=getappdata(figurehandleX,'figurehandle');
    tfpanel=uipanel('unit','normalized','parent',fig,'Title','Time Frame','fontsize',8,...
        'position',[0.24 0.78  0.7 0.2],'backgroundcolor',cor);
    tfT_tstop=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.88 0.2222 0.0444],'string','Time Stop','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: tstop');
    tstop=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.50 0.89 0.2222 0.0444],'string','1000','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    tfU_tstop=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.74 0.88 0.18 0.0444],'string','[Seconds]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    tfT_CFL=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.79 0.2222 0.0444],'string','Courant Number','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.1\nMax: 0.9\nkey: CFL'));
    CFL=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.5 0.8 0.2222 0.0444],'string','0.7','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    tfU_CFL=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.74 0.79 0.15 0.0444],'string','[-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    handles{1,1}=[tfT_tstop tstop tfU_tstop tfT_CFL CFL tfU_CFL tfpanel];
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                          Main Button Domain                            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function domain_button(varargin)
global handles figurehandleX cor xbclock d3dclock bathyclock gridparclock kt handles_MB...
    handles_G
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles_MB,'foregroundcolor','k'); set(handles_MB(2),'foregroundcolor','b');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{2,1},'visible','on');
aux=max([bathyclock gridparclock]); aux2=max([d3dclock xbclock]);
if aux==gridparclock & aux2==d3dclock
    set(handles{2,2},'visible','on'); set(handles{2,3},'visible','on');
elseif aux==gridparclock & aux2==xbclock
    set(handles{2,2},'visible','on'); set(handles{2,4},'visible','on');
elseif aux==gridparclock & isempty(aux2);
    set(handles{2,2},'visible','on');
elseif aux==bathyclock
    set(handles{2,5},'visible','on');
end

if isempty(handles{2,1})
    fig=getappdata(figurehandleX,'figurehandle');
    dmpanel1=uipanel('unit','normalized','parent',fig,'Title','Domain','fontsize',8,...
        'position',[0.24 0.88  0.7 0.1],'backgroundcolor',cor);
    dm_gridsPB=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.30 0.9 0.15 0.0444],'string','Grid Parameters','fontsize',10,...
        'fontw','bold','callback',@gridsParameters);
    dm_bathyPB=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.515 0.9 0.15 0.0444],'string','Bathymetry','fontsize',10,...
        'fontw','bold','callback',@bathymetry);
    dm_obstaclesPB=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.73 0.9 0.15 0.0444],'string','Obstacles','fontsize',10,...
        'fontw','bold','enable','off');    
    handles_G=[dm_gridsPB dm_bathyPB dm_obstaclesPB];
    handles{2,1}=[dm_gridsPB dm_bathyPB dm_obstaclesPB dmpanel1];
end

function gridsParameters(varargin)
global handles figurehandleX cor d3dclock xbclock kt gridparclock handles_G...
    gr_xbstylePB gr_d3dstylePB
gridparclock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles_G,'foregroundcolor','k'); set(handles_G(1),'foregroundcolor','b');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{2,1},'visible','on');
aux=max([d3dclock xbclock]);
if aux==d3dclock;
    set(handles{2,2},'visible','on'); set(handles{2,3},'visible','on');
elseif aux==xbclock;
    set(handles{2,2},'visible','on'); set(handles{2,4},'visible','on');
end
if isempty(handles{2,2})
    fig=getappdata(figurehandleX,'figurehandle');
    grstyle=uipanel('unit','normalized','parent',fig,'Title','Domain Style','fontsize',8,...
        'position',[0.24 0.72  0.7 0.1],'backgroundcolor',cor);
    gr_d3dstylePB=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.30 0.745  0.25 0.0355],'string','Delft3D Form','fontsize',10,...
        'fontw','bold','callback',@d3dstyle_grid);
    gr_xbstylePB=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.63 0.745  0.25 0.0355],'string','Xbeach Form','fontsize',10,...
        'fontw','bold','callback',@xbstyle_grid,'enable','off');
    handles{2,2}=[handles{2,2} gr_xbstylePB gr_d3dstylePB grstyle];
end

function d3dstyle_grid(varargin)
global handles figurehandleX xyfile d3dValue_coor d3dMsize_Value d3dNsize_Value cor ...
    d3dtxt_coor d3dMsize_txt d3dNsize_txt d3dthetaMINT thetamin d3dthetaMINT2...
    d3dthetaMAXT thetamax d3dthetaMAXT2 d3d_dthetaT dtheta d3d_dthetaT2 ...
    d3d_theNautT1 thetanaut d3dclock d3dcstlineT d3dcstlinePOP...
    d3dcstlinefixPB d3d_analysepanel d3d_grcaracpanel D1 gr_xbstylePB gr_d3dstylePB...
    d3dgrPB_open gridform globalhand d3d_grpanel
set(gr_xbstylePB,'foregroundcolor','k'); set(gr_d3dstylePB,'foregroundcolor','b');
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles{2,4},'visible','off');
set(handles{2,1},'visible','on'); set(handles{2,2},'visible','on'); set(handles{2,3},'visible','on');
d3dclock=datenum(clock);
gridform='delft3d';
if isempty(handles{2,3})
    fig=getappdata(figurehandleX,'figurehandle');
    d3d_grpanel=uipanel('unit','normalized','parent',fig,'Title','Grid - Delft3D Form','fontsize',8,...
        'position',[0.24 0.05  0.7 0.61],'backgroundcolor',cor);
    d3d_analysepanel=uipanel('unit','normalized','parent',fig,'Title','Analyse XY origin','fontsize',8,...
        'position',[0.62 0.08 0.29 0.245],'backgroundcolor',cor,'foregroundcolor',[.6 .6 .6]);
    d3d_grcaracpanel=uipanel('unit','normalized','parent',fig,'Title','Grid Characteristics','fontsize',8,...
        'position',[0.27 0.08  0.32 0.215],'backgroundcolor',cor,'foregroundcolor',[.6 .6 .6]);
    xyfile=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.57 0.575  0.35 0.0355],'string','Filename Unknown','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    % d3denT_open=uicontrol('unit','points','parent',fig,'style','text',...
    %     'position',[360 height*1.4-29 100 17],'string','Filename Unknown','fontsize',10,...
    %     'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    d3dgrPB_open=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.3 0.58  0.25 0.0355],'string','Open Grid','fontsize',10,...
        'fontw','bold','callback',@openGRID,'max',1);
    % d3dencPB_open=uicontrol('unit','points','parent',fig,'style','pushbutton',...
    %     'position',[200 height*1.4-25 150 17],'string','Open Grid Enclosure','fontsize',10,...
    %     'fontw','bold','callback',@openENC);
    d3dthetaMINT=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.335 0.49  0.1 0.0355],'string','Theta Min:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltip',sprintf('Lower Directional\nLimit\nkey: thetamin'),'enable','off');
    thetamin=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.45 0.495  0.085 0.0355],'string','0','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','right','enable','off');
    d3dthetaMINT2=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.55 0.49  0.3 0.0355],'string','Angle w.r.t. computational x-axis','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    d3dthetaMAXT=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.335 0.435  0.1 0.0355],'string','Theta Max:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltip',sprintf('Upper Directional\nLimit\nkey: thetamax'),'enable','off');
    thetamax=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.45 0.44  0.085 0.0355],'string','270','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','right','enable','off');
    d3dthetaMAXT2=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.55 0.435  0.3 0.0355],'string','Angle w.r.t. computational x-axis','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    d3d_dthetaT=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.335 0.38  0.15 0.0355],'string','Directional Theta:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltip',sprintf('Directional\nResolution'),'enable','off');
    dtheta=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.495 0.38  0.04 0.0355],'string','20','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','right','enable','off');
    d3d_dthetaT2=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.55 0.38  0.08 0.0355],'string','[Deg]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    d3d_theNautT1=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.335 0.325  0.20 0.0355],'string','Angle Convention:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    %     d3d_theNautT2=uicontrol('unit','normalized','parent',fig,'style','text',...
    %         'position',[0.55 0.325 0.3 0.0355],'string','[0 - Cartesian / 1 - Nautical]','fontsize',10,...
    %         'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    thetanaut=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.505 0.329 0.1 0.0355],'string','Cartesian|Nautical','fontsize',10,...% string 1
        'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','right','value',2,'enable','off');
    
    d3dtxt_coor=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.29 0.22  0.20 0.0355],'string','Coordinate System:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    d3dValue_coor=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.48 0.22  0.08 0.0355],'string','','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    d3dMsize_txt=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.29 0.16  0.23 0.0355],'string','Grid Points in M direction:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    d3dMsize_Value=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.51 0.16  0.06 0.0355],'string','','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    d3dNsize_txt=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.29 0.10  0.23 0.0355],'string','Grid Points in N direction:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    d3dNsize_Value=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.51 0.10 0.06 0.0355],'string','','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    d3dcstlineT=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.64 0.26  0.18 0.0355],'string','Coastline Position:','fontsize',8,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    d3dcstlinePOP=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.78 0.273  0.11 0.028],'string',...
        'None|NorthWest|West|South|East|North','fontsize',8,...
        'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','left','enable','off',...
        'callback',@analyse_xyorgin); D1=1;
    d3dcstlinefixPB=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.792 0.11  0.08 0.0355],'string',...
        'Fix','fontsize',10,'fontw','bold','backgroundcolor',cor,...
        'horizontalalignment','left','enable','off','visible','off');
        
    handles{2,3}=[handles{2,3} xyfile d3dgrPB_open d3dtxt_coor ...
        d3dMsize_txt d3dNsize_txt d3dValue_coor d3dMsize_Value d3dNsize_Value ...
        d3dthetaMINT thetamin d3dthetaMINT2 d3dthetaMAXT thetamax ...
        d3dthetaMAXT2 d3d_dthetaT dtheta d3d_dthetaT2 d3d_theNautT1...
        thetanaut d3dcstlineT d3dcstlinePOP  d3dcstlinefixPB d3d_grpanel d3d_analysepanel...
        d3d_grcaracpanel];
    
    globalhand{1,2}={gridform; xyfile; thetamin; thetamax; dtheta; thetanaut};
end

function bathymetry(height,varargin)
global handles figurehandleX cor d3ddepPB_open d3ddepUn_edit d3ddepUn_edit1 depfile A ...
    d3ddepTMax_open d3ddepValueMax_open d3ddepValueMin_open kt bathyclock...
    handles_G globalhand u0 u1
 
if isempty(A)
    alertFigure('Load Grid Before!');
    %     questGRID=questdlg('You need to open a grid!', ...
    %         'Xbeach GUI','Yes','No','xalala');
    %     switch questGRID
    %         case 'Yes'
    %             gridsParameters(height,varargin)
    %             return
    %         case 'No'
    %             return
    %     end
else
    set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
    set(handles_G,'foregroundcolor','k'); set(handles_G(2),'foregroundcolor','b');
    bathyclock=datenum(clock);
    for k=1:kt
        for g=1:length(handles(:,1))
            if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
        end
    end
    set(handles{2,1},'visible','on'); set(handles{2,5},'visible','on');
    if isempty(handles{2,5})
        fig=getappdata(figurehandleX,'figurehandle');
        d3dbathy_panel=uipanel('unit','normalized','parent',fig,'Title','Bathymetry','fontsize',8,...
            'position',[0.24 0.54  0.7 0.28],'backgroundcolor',cor);
        % Create the button group.
        h = uibuttongroup('unit','normalized','parent',fig,'visible','off',...
            'Position',[0.30 0.55  0.6 0.23],'backgroundcolor',cor,'bordertype','none');
        u0 = uicontrol('unit','normalized','Style','Radio','String','File',...
            'pos',[0 0.6  0.2 0.2],'parent',h,'HandleVisibility','off',...
            'backgroundcolor',cor,'fontsize',10,'fontw','bold');
        u1 = uicontrol('unit','normalized','Style','Radio','String','Uniform',...
            'pos',[0 0.2  0.2 0.2],'parent',h,'HandleVisibility','off',...
            'backgroundcolor',cor,'fontsize',10,'fontw','bold');
        set(h,'SelectionChangeFcn',@seldepFILE); set(h,'SelectedObject',u1); set(h,'Visible','on');
        
        d3ddepPB_open=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
            'position',[0.40 0.695  0.25 0.0355],'string','Open Bathymetry','fontsize',10,...
            'fontw','bold','callback',@openDEPTH,'enable','off');
        depfile=uicontrol('unit','normalized','parent',fig,'style','text',...
            'position',[0.67 0.692  0.21 0.0355],'string','Filename Unknown','fontsize',10,...
            'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
        d3ddepTMax_open=uicontrol('unit','normalized','parent',fig,'style','text',...
            'position',[0.67 0.662  0.21 0.0355],'string','Min:               |   Max:','fontsize',10,...
            'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
        d3ddepValueMax_open=uicontrol('unit','normalized','parent',fig,'style','text',...
            'position',[0.711 0.6635  0.06 0.0355],'string','','fontsize',10,...
            'fontw','bold','backgroundcolor',cor,'horizontalalignment','right','enable','off');
        d3ddepValueMin_open=uicontrol('unit','normalized','parent',fig,'style','text',...
            'position',[0.845 0.6635  0.05 0.0355],'string','','fontsize',10,...
            'fontw','bold','backgroundcolor',cor,'horizontalalignment','right','enable','off');
        
        d3ddepUn_edit=uicontrol('unit','normalized','parent',fig,'style','edit',...
            'position',[0.4 0.60  0.10 0.0355],'string','10','fontsize',10,...
            'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','right');
        d3ddepUn_edit1=uicontrol('unit','normalized','parent',fig,'style','text',...
            'position',[0.52 0.602  0.30 0.0355],'string','[m] below reference level','fontsize',10,...
            'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
        handles{2,5}=[handles{2,5} h u0 u1 d3ddepPB_open depfile...
            d3ddepUn_edit d3ddepUn_edit1 d3dbathy_panel d3ddepTMax_open ...
            d3ddepValueMax_open d3ddepValueMin_open];
        
        globalhand{1,3}=depfile;
    end
end

function xbstyle_grid(varargin)
global handles figurehandleX cor xbclock xbtxt_coor xbValue_coor xbMsize_txt ...
    xbMsize_Value xbNsize_txt xbNsize_Value xbgrTY_open xbgrTX_open kt...
    gr_xbstylePB gr_d3dstylePB
xbclock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(gr_d3dstylePB,'foregroundcolor','k'); set(gr_xbstylePB,'foregroundcolor','b');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{2,1},'visible','on'); set(handles{2,2},'visible','on'); set(handles{2,4},'visible','on');
if isempty(handles{2,4})
    fig=getappdata(figurehandleX,'figurehandle');
    dXb_grpanel=uipanel('unit','normalized','parent',fig,'Title','Grid - Xbeach Form','fontsize',8,...
        'position',[0.24 0.1  0.7 0.56],'backgroundcolor',cor);
    xbgrTX_open=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.57 0.575  0.35 0.0355],'string','Filename Unknown','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    xbgrXPB_open=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.3 0.58  0.25 0.0355],'string','Open X Grid','fontsize',10,...
        'fontw','bold','callback',@openGRID,'max',2);
    xbgrTY_open=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.57 0.535  0.35 0.0355],'string','Filename Unknown','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    xbgrYPB_open=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.3 0.54  0.25 0.0355],'string','Open Y Grid','fontsize',10,...
        'fontw','bold','callback',@openGRID,'max',3);
    
    xbtxt_coor=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.335 0.24  0.20 0.0355],'string','Coordinate System:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    xbValue_coor=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.555 0.24  0.20 0.0355],'string','','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    xbMsize_txt=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.335 0.185  0.23 0.0355],'string','Grid Points in M direction:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    xbMsize_Value=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.585 0.185  0.23 0.0355],'string','','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    xbNsize_txt=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.335 0.13  0.23 0.0355],'string','Grid Points in N direction:','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    xbNsize_Value=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.585 0.13 0.23 0.0355],'string','','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');    
    handles{2,4}=[handles{2,4} dXb_grpanel xbtxt_coor xbValue_coor xbMsize_txt ...
        xbMsize_Value xbNsize_txt xbNsize_Value xbgrTX_open xbgrXPB_open xbgrTY_open ...
        xbgrYPB_open];
end

function seldepFILE(source,eventdata)
global d3ddepPB_open d3ddepUn_edit d3ddepUn_edit1 depfile figurehandleX
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
aux=source;
if strcmp(get(eventdata.OldValue,'String'),'Uniform')%file
    set(d3ddepPB_open,'enable','on')
    set(d3ddepUn_edit,'enable','off');
    set(d3ddepUn_edit1,'enable','off');
    set(depfile,'enable','on');    
else%uniform
    set(d3ddepPB_open,'enable','off');
    set(d3ddepUn_edit,'enable','on');
    set(d3ddepUn_edit1,'enable','on');
    set(depfile,'enable','off');
end

function openGRID(hobj,varargin)
global xyfile gridD3D d3dValue_coor d3dMsize_Value d3dNsize_Value A xgrid ygrid ...
    d3dtxt_coor d3dMsize_txt d3dNsize_txt d3dthetaMINT thetamin d3dthetaMINT2...
    d3dthetaMAXT thetamax d3dthetaMAXT2 d3d_dthetaT dtheta d3d_dthetaT2 ...
    d3d_theNautT1 d3d_theNautT2 thetanaut d3dcstlinefixPB...
    d3dcstlineT d3dcstlinePOP d3d_grcaracpanel  d3d_analysepanel cpanel h...
    d3dgrPB_open D1 d3dcstlinefixT figxyO figurehandleX
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
D1=1;
set(d3dgrPB_open,'foregroundcolor','b');
value=get(hobj,'max');
if value==1 % d3dgrid
    [file,path]=uigetfile({'*.grd','Grid (*.grd)'},'Pick a File');
    if file==0
        set(xyfile,'String','Filename Unknown');
    else
        clear gridD3D
        gridD3D=wlgrid('read',[path,file]);
        [m,n]=size(gridD3D.X);
        set(xyfile,'String',file);
        set(d3dValue_coor,'string',gridD3D.CoordinateSystem);
        set(d3dMsize_Value,'string',num2str(m));
        set(d3dNsize_Value,'string',num2str(n));
        set(d3dtxt_coor,'enable','on');
        set(d3dMsize_txt,'enable','on');
        set(d3dNsize_txt,'enable','on');%
        set(d3dthetaMINT,'enable','on'); set(thetamin,'enable','on');
        set(d3dthetaMINT2,'enable','on'); set(d3dthetaMAXT,'enable','on');
        set(thetamax,'enable','on'); set(d3dthetaMAXT2,'enable','on');
        set(d3d_dthetaT,'enable','on'); set(dtheta,'enable','on');
        set(d3d_dthetaT2,'enable','on'); set(d3d_theNautT1,'enable','on');
        set(d3d_theNautT2,'enable','on'); set(thetanaut,'enable','on');
        set(d3dcstlineT,'enable','on'); set(d3dcstlinePOP,'enable','on');
        set(d3d_grcaracpanel,'foregroundcolor',[0 0 0]);
        set(d3d_analysepanel,'foregroundcolor',[0 0 0]);
        set(d3dcstlinefixPB,'visible','on');
        set(d3dcstlinePOP,'value',1);
        delete([d3dcstlinefixT figxyO]);
        xgrid=gridD3D.X; ygrid=gridD3D.Y;
        A=1;
        % call attention for xy grid origin
        h=1;
        cpanel= timer('TimerFcn',@colorpanel,'StartDelay',0, ...
            'Period',0.5,'Name','aa','ExecutionMode','fixedrate',...
            'taskstoexecute',5); start(cpanel);
    end
elseif value==2
    [file,path]=uigetfile({'*.grd','X Grid - XbForm (*.grd)'},'Pick a File');
elseif value==3
    [file,path]=uigetfile({'*.grd','Y Grid - XbForm (*.grd)'},'Pick a File');
end

function colorpanel(varargin)
global d3d_analysepanel cpanel h
colors=[1,0,0 ; 0,0,0 ; 1,0,0 ; 0,0,0 ; 1,0,0];
set(d3d_analysepanel,'foregroundcolor',[colors(h,1) colors(h,2) colors(h,3)],...
    'fontw','bold','fontsize',11);
if h==5
    stop(cpanel);
    set(d3d_analysepanel,'fontw','bold','fontsize',8);
end
h=h+1;

function analyse_xyorgin(varargin)
global handles cor figurehandleX d3dcstlineT d3dcstlinePOP  d3dcstlinefixPB d3d_analysepanel...
    xgrid ygrid figxyO d3dcstlinefixT D1
fig=getappdata(figurehandleX,'figurehandle');
if D1==1
    d3dcstlinefixT=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.77 0.155  0.12 0.0355],'string','Status: Check!','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','on');
    figxyO=uicontrol('units','normalized','parent',fig,...
        'position',[0.65 0.099 0.112 0.163],'selected','off');
    
    handles{2,3}=[handles{2,3} figxyO d3dcstlinefixT];
    D1=D1+1;
end

[xMax,idxmax]=max(xgrid(:)); [yMax,idymax]=max(ygrid(:));
[xMin,idxmin]=min(xgrid(:)); [yMin,idymin]=min(ygrid(:));
x1=xgrid(1,1); xEnd1=xgrid(end,1); x1End=xgrid(1,end); xEndEnd=xgrid(end,end);
y1=ygrid(1,1); yEnd1=ygrid(end,1); y1End=ygrid(1,end); yEndEnd=ygrid(end,end);

if get(d3dcstlinePOP,'value')==2 %NorthWest
    if x1 == xMax & yEnd1==yMax
        set(d3dcstlinefixT,'string','Status: Ok!','foregroundcolor','b');
        set(d3dcstlinefixPB,'enable','off');
        clear pI; pI=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\p1.png');
        set(figxyO,'cdata',pI);
    elseif (xMin<x1) && (x1<xMax) & y1==yMin  % INCOMPLETE - REVISE
        clear pI; pI=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\p2.png');
        set(figxyO,'cdata',pI);
        set(d3dcstlinefixT,'string','Status: Check!','enable','on','foregroundcolor','r');
        set(d3dcstlinefixPB,'enable','on');
    elseif (yMin<y1) && (y1<yMax) & x1==xMin
        clear pI; pI=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\p3.png');
        set(figxyO,'cdata',pI);
        set(d3dcstlinefixT,'string','Status: Check!','enable','on','foregroundcolor','r');
        set(d3dcstlinefixPB,'enable','on');
    elseif (xMin<x1) && (x1<xMax) & y1==yMax
        clear pI; pI=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\p4.png');
        set(figxyO,'cdata',pI);
        set(d3dcstlinefixT,'string','Status: Check!','enable','on','foregroundcolor','r');
        set(d3dcstlinefixPB,'enable','on');
    end
elseif get(d3dcstlinePOP,'value')==3 %West
    if x1 == xMax | x1 < xMax-xMax*0.01 & xEnd1 ==xMin | xEnd1 < xMin+xMin*0.01
        set(d3dcstlinefixT,'string','Status: Ok!','foregroundcolor','b');
        set(d3dcstlinefixPB,'enable','off');
        clear pI; pI=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\p1.png');
        set(figxyO,'cdata',pI);
    elseif y1 == yMin & idymin == 1 % INCOMPLETE - REVISE
        clear pI; pI=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\p2.png');
        set(figxyO,'cdata',pI);
        set(d3dcstlinefixT,'string','Status: Check!','enable','on','foregroundcolor','r');
        set(d3dcstlinefixPB,'enable','on');
    end
end
set(d3d_analysepanel,'foregroundcolor',[0 0 0]);

function openDEPTH(hObj,event)
global depfile xgrid ygrid d3ddepTMax_open d3ddepValueMax_open ...
    d3ddepValueMin_open B1 d3ddepPB_open figurehandleX zs0file_PB zs0file ...
    ne_layerPB ne_layer
if hObj == d3ddepPB_open
    set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
    set(d3ddepPB_open,'foregroundcolor','b');
    gridD3D.X=xgrid; gridD3D.Y=ygrid;
    [file,path]=uigetfile({'*.dep','Depth (*.dep)'},'Pick a File');
    if file==0
        set(depfile,'String','Filename Unknown');
    else
        clear bathyD3D
        try
            [bathyD3D]=wldep('read',[path,file],gridD3D);
    %         if ~isempty(verifyDEPTH)
    %             alertFigure('Wrong Bathymetry file!');
    %             return
    %         end
            bathyD3D=bathyD3D(1:end-1,1:end-1);
            Bmax=nanmax(bathyD3D(:)); Bmin=nanmin(bathyD3D(:));
            set(depfile,'String',file);
            set(d3ddepTMax_open,'enable','on');
            set(d3ddepValueMax_open,'enable','on','string',sprintf('%3.1f',Bmin));
            set(d3ddepValueMin_open,'enable','on','string',sprintf('%3.1f',Bmax));
            B1=bathyD3D;
        catch
            alertFigure('Wrong Bathymetry file!');
            return
        end
    end
elseif hObj ==  zs0file_PB
    set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
    [file,path]=uigetfile({'*.txt','Tide/Surge (*.txt)'},'Pick a File');
    if file==0
        set(zs0file,'String','Filename Unknown');
    else
        set(zs0file,'string',file);
    end
elseif hObj == ne_layerPB
    set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
    [file,path]=uigetfile({'*.dep','Bed Thickness (*.dep)'},'Pick a File');
    if file==0
        set(ne_layer,'String','Filename Unknown');
    else
        set(ne_layer,'string',file,'enable','on');
    end
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                         Main Button Processes                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function processes_button(varargin)
global handles figurehandleX cor sedtrans morphology kt handles_MB...
    swave lwave flow nonh gwflow q3d globalhand
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles_MB,'foregroundcolor','k'); set(handles_MB(3),'foregroundcolor','b');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{3,1},'visible','on');
set(handles_MB(5),'enable','on');
if isempty(handles{3,1})
    fig=getappdata(figurehandleX,'figurehandle');
    proc_panel=uipanel('unit','normalized','parent',fig,'Title','Physical Processes','fontsize',8,...
        'position',[0.24 0.48  0.7 0.5],'backgroundcolor',cor);
    swave=uicontrol('unit','normalized','parent',fig,'style','check',...
        'String','Short Waves','fontsize',10,'fontw','bold','position',[0.33 0.85  0.2 0.0444],...
        'backgroundcolor',cor,'value',1);
    lwave=uicontrol('unit','normalized','parent',fig,'style','check',...
        'String','Long Waves','fontsize',10,'fontw','bold','position',[0.33 0.78  0.2 0.0444],...
        'backgroundcolor',cor,'value',1);
    flow=uicontrol('unit','normalized','parent',fig,'style','check',...
        'String','NLSW Equations','fontsize',10,'fontw','bold','position',[0.33 0.71  0.2 0.0444],...
        'backgroundcolor',cor,'value',1,...
        'tooltipstring',sprintf('NonLinear Shallow Water equation'));...
    sedtrans=uicontrol('unit','normalized','parent',fig,'style','check',...
        'String','Sediment Transport','fontsize',10,'fontw','bold','position',[0.33 0.64  0.2 0.0444],...
        'backgroundcolor',cor,'value',1);
    morphology=uicontrol('unit','normalized','parent',fig,'style','check',...
        'String','Bathymetry Update','fontsize',10,'fontw','bold','position',[0.33 0.57  0.2 0.0444],...
        'backgroundcolor',cor,'value',1);
    nonh=uicontrol('unit','normalized','parent',fig,'style','check',...
        'String','NonHydrostatic Flow','fontsize',10,'fontw','bold','position',[0.65 0.85  0.2 0.0444],...
        'backgroundcolor',cor,'value',0,...
        'tooltipstring',sprintf('NLSW equation without wave-action driver'));
    gwflow=uicontrol('unit','normalized','parent',fig,'style','check',...
        'String','Groundwater Flow','fontsize',10,'fontw','bold','position',[0.65 0.78  0.2 0.0444],...
        'backgroundcolor',cor,'value',0);
    q3d=uicontrol('unit','normalized','parent',fig,'style','check',...
        'String','quasi-3D Model (NYI)','fontsize',10,'fontw','bold','position',[0.65 0.71  0.2 0.0444],...
        'backgroundcolor',cor,'value',0,...
        'tooltipstring','Not Yet Implemented');    
    handles{3,1}=[handles{3,1} proc_panel swave lwave flow sedtrans morphology...
        nonh gwflow q3d];
    globalhand{1,4}={swave; lwave; flow; sedtrans; morphology; nonh; gwflow; q3d};
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                         Main Button Limiters                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function limiters_button(varargin)
global handles figurehandleX cor kt handles_MB...
    hmin eps umin hwci globalhand
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles_MB,'foregroundcolor','k'); set(handles_MB(4),'foregroundcolor','b');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{4,1},'visible','on');
if isempty(handles{4,1})
    fig=getappdata(figurehandleX,'figurehandle');
    limiters_panel=uipanel('unit','normalized','parent',fig,'Title','Limiters','fontsize',8,...
        'position',[0.24 0.64  0.7 0.34],'backgroundcolor',cor);
    hmin_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.88  0.6 0.0444],'string',...
        'Min. depth for concentration and return flow                                     [m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: hmin');
    hmin=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.67 0.887 0.15 0.0444],'string','0.05','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    eps_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.81  0.6 0.0444],'string',...
        'Min. depth for drying and flooding                                                     [m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: eps');
    eps=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.67 0.817 0.15 0.0444],'string','0.005','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    umin_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.74  0.6 0.0444],'string',...
        'Min. veloc. for upwind scheme                                                          [m/s]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: umin');
    umin=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.67 0.747 0.15 0.0444],'string','0.0','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    hwci_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.67  0.6 0.0444],'string',...
        'Depth below which wci is no aplied                                                  [m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: hwci');
    hwci=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.67 0.677 0.15 0.0444],'string','0.1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    handles{4,1}=[handles{4,1} limiters_panel hmin_text hmin ...
        eps_text eps umin_text umin hwci_text hwci];
    
    globalhand{1,5}={hmin; eps; umin; hwci};
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Main Button Physical Parameters                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function phy_parameters_button(varargin)
global handles figurehandleX cor sedtrans morphology tab_constants tab_flow ...
    tab_wave tab_wind kt constantsclock flowclock waveclock windclock...
    sedtranspclock morphoclock tab_sed_transp tab_morphoUP handles_MB
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles_MB,'foregroundcolor','k'); set(handles_MB(5),'foregroundcolor','b');
% persistent tab_sed_transp tab_morphoUP
fig=getappdata(figurehandleX,'figurehandle');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{5,1},'visible','on');
aux=max([constantsclock flowclock waveclock windclock...
    sedtranspclock morphoclock]);
if aux==constantsclock;
    set(handles{5,2},'visible','on');
    set(handles{5,1},'value',0);
    set([tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP],'foregroundcolor','k');
    set(tab_constants,'foregroundcolor','b');
elseif aux==flowclock;
    set(handles{5,3},'visible','on');
    set(handles{5,1},'value',0);
    set([tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP],'foregroundcolor','k');
    set(tab_flow,'foregroundcolor','b');
elseif aux==waveclock;
    set(handles{5,4},'visible','on');
    set(handles{5,1},'value',0);
    set([tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP],'foregroundcolor','k');
    set(tab_wave,'foregroundcolor','b');
elseif aux==windclock;
    set(handles{5,5},'visible','on');
    set(handles{5,1},'value',0);
    set([tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP],'foregroundcolor','k');
    set(tab_wind,'foregroundcolor','b');
elseif aux==sedtranspclock;
    set(handles{5,6},'visible','on');
    set(handles{5,1},'value',0);
    set([tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP],'foregroundcolor','k');
    set(tab_sed_transp,'foregroundcolor','b');
elseif aux==morphoclock;
    set(handles{5,7},'visible','on');
    set(handles{5,1},'value',0);
    set([tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP],'foregroundcolor','k');
    set(tab_morphoUP,'foregroundcolor','b');
end


if ~isempty(tab_sed_transp) & get(sedtrans,'value')==0
    if ishghandle(tab_sed_transp); delete(tab_sed_transp); clear tab_sed_transp;
        set(handles{5,6},'visible','off');
    end
    if get(morphology,'value')==1
        if ishghandle(morphology)==1
            set(tab_morphoUP,'position',[0.72 0.9445  0.12 0.0355]);
        else
            tab_morphoUP=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
                'position',[0.72 0.9445  0.12 0.0355],'string','Morphological','fontsize',8,...
                'fontw','bold','callback',@morphoTAB,'foregroundcolor','k');
        end
        handles{5,1}=[]; handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind tab_morphoUP];
    else
        handles{5,1}=[]; handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind];
    end
elseif isempty(tab_sed_transp) & get(sedtrans,'value')==1
    tab_sed_transp=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.72 0.9445  0.12 0.0355],'string','Sed. Transp.','fontsize',8,...
        'fontw','bold','callback',@sedtranspTAB,'foregroundcolor','k');
    handles{5,1}=[handles{5,1} tab_sed_transp];
end
if ~isempty(tab_morphoUP) & get(morphology,'value')==0
    if ishghandle(tab_morphoUP); delete(tab_morphoUP); clear tab_morphoUP;
        set(handles{5,7},'visible','off');
    end
    if get(sedtrans,'value')==1
        handles{5,1}=[]; handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind tab_sed_transp];
    else
        handles{5,1}=[]; handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind ];
    end
elseif isempty(tab_morphoUP) & get(morphology,'value')==1
    if get(sedtrans,'value')==0
        p1=[0.72 0.9445  0.12 0.0355];
    else
        p1=[0.84 0.9445  0.12 0.0355];
    end
    tab_morphoUP=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',p1,'string','Morphological','fontsize',8,...
        'fontw','bold','callback',@morphoTAB,'foregroundcolor','k');
    handles{5,1}=[handles{5,1} tab_morphoUP];
end
if get(sedtrans,'value')==1 & get(morphology,'value')==1 &...
        ishghandle(tab_sed_transp)==1 & ishghandle(tab_morphoUP)==1
    set(tab_sed_transp,'position',[0.72 0.9445  0.12 0.0355]);
    set(tab_morphoUP,'position',[0.84 0.9445  0.12 0.0355]);
    handles{5,1}=[]; handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP];
elseif get(sedtrans,'value')==1 & get(morphology,'value')==1 &...
        ishghandle(tab_sed_transp)==1 & ishghandle(tab_morphoUP)==0
    set(tab_sed_transp,'position',[0.72 0.9445  0.12 0.0355]);
    tab_morphoUP=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.84 0.9445  0.12 0.0355],'string','Morphological','fontsize',8,...
        'fontw','bold','callback',@morphoTAB,'foregroundcolor','k');
    handles{5,1}=[]; handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP];
elseif get(sedtrans,'value')==1 & get(morphology,'value')==1 &...
        ishghandle(tab_sed_transp)==0 & ishghandle(tab_morphoUP)==1
    set(tab_morphoUP,'position',[0.84 0.9445  0.12 0.0355]);
    tab_sed_transp=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.72 0.9445  0.12 0.0355],'string','Sed. Transp.','fontsize',8,...
        'fontw','bold','callback',@sedtranspTAB,'foregroundcolor','k');
    handles{5,1}=[]; handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP];
elseif get(sedtrans,'value')==1 & get(morphology,'value')==1 &...
        ishghandle(tab_sed_transp)==0 & ishghandle(tab_morphoUP)==0
    tab_sed_transp=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.72 0.9445  0.12 0.0355],'string','Sed. Transp.','fontsize',8,...
        'fontw','bold','callback',@sedtranspTAB,'foregroundcolor','k');
    tab_morphoUP=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.84 0.9445  0.12 0.0355],'string','Morphological','fontsize',8,...
        'fontw','bold','callback',@morphoTAB,'foregroundcolor','k');
    handles{5,1}=[]; handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind tab_sed_transp tab_morphoUP];
end
if length(handles{5,1}) < 4%isempty(handles{4,1})
    tab_constants=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.24 0.9445  0.12 0.0355],'string','Constants','fontsize',8,...
        'fontw','bold','callback',@constantsTAB);
    tab_flow=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.36 0.9445  0.12 0.0355],'string','Flow','fontsize',8,...
        'fontw','bold','callback',@flowTAB);
    tab_wave=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.48 0.9445  0.12 0.0355],'string','Wave','fontsize',8,...
        'fontw','bold','callback',@waveTAB);
    tab_wind=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.60 0.9445  0.12 0.0355],'string','Wind','fontsize',8,...
        'fontw','bold','callback',@windTAB);
    % if isempty(tab_sed_transp)
    % tab_sed_transp=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
    %     'position',[0.72 0.9445  0.12 0.0355],'string','Sed. Transp.','fontsize',8,...
    %     'fontw','bold','callback',@sedtranspTAB);
    % end
    % if isempty(tab_morphoUP)
    % tab_morphoUP=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
    %     'position',[0.84 0.9445  0.12 0.0355],'string','Morphological','fontsize',8,...
    %     'fontw','bold','callback',@morphoTAB);
    % end
    handles{5,1}=[handles{5,1} tab_constants tab_flow tab_wave tab_wind];
end

function constantsTAB(varargin)
global handles figurehandleX cor kt constantsclock tab_constants ...
    tab_flow  tab_wave tab_wind tab_sed_transp tab_morphoUP gravity_value rho...
    globalhand
constantsclock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{5,1},'visible','on'); set(handles{5,2},'visible','on');
if ishghandle(tab_sed_transp)==1 & ishghandle(tab_morphoUP)==1
    set([tab_flow,tab_wave,tab_wind,tab_sed_transp,tab_morphoUP],...
        'foregroundcolor','k'); set(tab_constants,'foregroundcolor','b');
elseif ishghandle(tab_sed_transp)==1 & ishghandle(tab_morphoUP)==0
    set([tab_flow,tab_wave,tab_wind,tab_sed_transp],...
        'foregroundcolor','k'); set(tab_constants,'foregroundcolor','b');
elseif ishghandle(tab_sed_transp)==0 & ishghandle(tab_morphoUP)==1
    set([tab_flow,tab_wave,tab_wind,tab_morphoUP],...
        'foregroundcolor','k'); set(tab_constants,'foregroundcolor','b');
elseif ishghandle(tab_sed_transp)==0 & ishghandle(tab_morphoUP)==0
    set([tab_flow,tab_wave,tab_wind],...
        'foregroundcolor','k'); set(tab_constants,'foregroundcolor','b');
end
if isempty(handles{5,2})
    fig=getappdata(figurehandleX,'figurehandle');
    const_panel=uipanel('unit','normalized','parent',fig,'Title','Constants','fontsize',8,...
        'position',[0.24 0.73  0.7 0.2],'backgroundcolor',cor);
    gravity_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.83  0.5 0.0444],'string',...
        'Gravity Acceleration                                           [m/s]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    gravity_value=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.50 0.837 0.15 0.0444],'string','9.81','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    rho_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.76  0.5 0.0444],'string',...
        'Water Density                                                   [kg/m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    rho=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.50 0.767 0.15 0.0444],'string','1025','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    handles{5,2}=[handles{5,2} const_panel gravity_text rho_text gravity_value rho];
    globalhand{1,6}={gravity_value; rho};
end

function flowTAB(varargin)
global handles figurehandleX cor kt flowclock tab_flow ...
    tab_constants  tab_wave tab_wind tab_sed_transp tab_morphoUP...
    cf C nuh nuhfac nuhv smag ...
    zs0file_PB zs0file tide_handle tide_panelPB tide_panelPB1 tideloc...
    tide_panel globalhand
flowclock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{5,1},'visible','on'); set(handles{5,3},'visible','on');
set([tab_constants,tab_wave,tab_wind,tab_sed_transp,tab_morphoUP],...
    'foregroundcolor','k'); set(tab_flow,'foregroundcolor','b');
if isempty(handles{5,3})
    fig=getappdata(figurehandleX,'figurehandle');
    tide_panelPB1=uicontrol('unit','normalized','parent',fig,'style','togglebutton','fontsize',8,...
        'position',[0.93 0.21  0.02 0.02],'backgroundcolor',cor,'visible','off',...
        'callback',@enable_tide);    
    tide_panel=uipanel('unit','normalized','parent',fig,'Title','Tide/Storm Surge','fontsize',8,...
        'position',[0.24 0.22  0.7 0.18],'backgroundcolor',cor,...
        'foregroundcolor',[.5 .5 .5]);
    tide_panelPB=uicontrol('unit','normalized','parent',fig,'style','togglebutton','fontsize',8,...
        'position',[0.24 0.22  0.7 0.18],'backgroundcolor',cor,'callback',@enable_tide);
    flow_panel=uipanel('unit','normalized','parent',fig,'Title','Flow','fontsize',8,...
        'position',[0.24 0.45  0.7 0.48],'backgroundcolor',cor);
%     roughness_panel=uipanel('unit','normalized','parent',fig,'Title','Roughness','fontsize',8,...
%         'position',[0.27 0.7  0.64 0.2],'backgroundcolor',cor,'titleposition','righttop');
    cf_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.83  0.6 0.0444],'string',...
        'Flow Friction Coefficient                                                     [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: cf');
    cf=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.585 0.837 0.15 0.0444],'string','0.003','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right','callback',@calculate_chezy);
    chezy_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.76  0.6 0.0444],'string',...
        'Chezy Coefficient                                                                [m//s]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','Sqrt(g/cf) -> key: C');
    C=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.585 0.767 0.15 0.0444],'string',...
        sprintf('%3.0f',sqrt(9.81/str2double(get(cf,'string')))),'fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    nuh_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.69  0.6 0.0444],'string',...
        'Horizontal Background Viscosity                                         [m/s]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: nuh');
    nuh=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.585 0.697 0.15 0.0444],'string','0.15','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    visco_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.62  0.6 0.0444],'string',...
        'Viscosity Coeff. for Roller                                                    [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',...
        sprintf('Viscosity coefficient for\nroller induced turbulent\nhorizontal viscosity -> key: nuhfac'));
    nuhfac=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.585 0.627 0.15 0.0444],'string','0','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right','tooltipstring',sprintf('Min - 0\nMax - 1'));
    sh_disp_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.55  0.6 0.0444],'string',...
        'Addit. Shear Dispersion Factor                                           [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','Svendsen & Putrevu (1994) -> Key: nuhv');
    nuhv=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.585 0.557 0.15 0.0444],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right','tooltipstring',sprintf('Min - 1\nMax - 20'));
    smago_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.48  0.6 0.0444],'string',...
        'Smagorinski Viscosity                                                         [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: smag');
    smag=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.585 0.487 0.15 0.0444],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right','tooltipstring',sprintf('Min - 0\nMax - 1'));
    
    zs0file_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.31  0.6 0.0444],'string',...
        'Time-varying water level signal','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Max: 4\nkey: zs0file'),'enable','off');
    zs0file=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.75 0.31  0.17 0.0444],'string',...
        'Filename Unknown','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    zs0file_PB=uicontrol('unit','normalized','parent',fig','style','pushbutton',...
        'position',[0.585 0.317 0.15 0.0444],'string','Open file','fontsize',10,...
        'fontw','bold','SelectionHighlight','on','enable','off',...
        'horizontalalignment','right','callback',@openDEPTH);
    tideloc_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.24  0.6 0.0444],'string',...
        'Number of input tidal time series','fontsize',10,'enable','off',...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Max: 4\nkey: tideloc'));
    tideloc=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.585 0.247 0.15 0.0444],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right','enable','off');
    tide_handle=[zs0file_text zs0file zs0file_PB...
        tideloc_text tideloc];
    
    handles{5,3}=[handles{5,3} flow_panel cf_text cf chezy_text C nuh_text nuh visco_text...
        nuhfac sh_disp_text nuhv nuhv smago_text smag...
        tide_panelPB1 tide_handle tide_panel tide_panelPB];
    globalhand{1,7}={cf; C; nuh; nuhfac; nuhv; smag; zs0file; tideloc};
end

function enable_tide(hObj,event)
global tide_handle tide_panelPB tide_panelPB1 zs0file tide_panel
if hObj == tide_panelPB
    set(gcbo,'visible','off');
    set(tide_handle,'enable','on');
    set(tide_panelPB1,'visible','on','value',0);   
    set(tide_panel,'foregroundcolor','k');
elseif hObj == tide_panelPB1
    set(tide_panelPB,'visible','on','value',0);  
    set(tide_handle,'enable','off');  
    set(gcbo,'visible','off');
    set(tide_panel,'foregroundcolor',[.5 .5 .5]);
    set(zs0file,'string','Filename Unknown');    
end

function waveTAB(varargin)
global handles figurehandleX cor kt waveclock tab_wave...
    tab_constants tab_flow tab_wind tab_sed_transp tab_morphoUP...
    wavint wci gamma gammax alpha...
    n roller beta scheme break_value globalhand
waveclock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{5,1},'visible','on'); set(handles{5,4},'visible','on');
set([tab_constants,tab_flow,tab_wind,tab_sed_transp,tab_morphoUP],...
    'foregroundcolor','k'); set(tab_wave,'foregroundcolor','b');
if isempty(handles{5,4})
    fig=getappdata(figurehandleX,'figurehandle');
    act_bal_panel=uipanel('unit','normalized','parent',fig,'Title','Action Balance','fontsize',8,...
        'position',[0.24 0.74  0.7 0.19],'backgroundcolor',cor);
    dissipat_panel=uipanel('unit','normalized','parent',fig,'Title','Dissipation Model','fontsize',8,...
        'position',[0.24 0.4  0.7 0.33],'backgroundcolor',cor);
    roller_model_panel=uipanel('unit','normalized','parent',fig,'Title','Roller Model','fontsize',8,...
        'position',[0.24 0.2  0.7 0.19],'backgroundcolor',cor);
    wavint_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.86  0.6 0.0344],'string',...
        'Interval between stationay wave module                                       [s]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('instat = 0 only\nMin: 1\nMax: 3600\nkey: wavint'));
    wavint=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.68 0.863 0.12 0.0344],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    scheme_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.81  0.6 0.0344],'string',...
        'Numerical Scheme                                                                         [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('1 = Upwind\n2 = Lax Wendroff\nkey: scheme'));
    scheme=uicontrol('unit','normalized','parent',fig','style','popup',...
        'position',[0.65 0.828 0.15 0.0244],'value',2,...
        'string','Upwind|Lax Wendroff','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    wci_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.76  0.6 0.0344],'string',...
        'Wave current interaction (instat = 0 only)                                       [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('key: wci'));
    wci=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.68 0.763 0.12 0.0344],'string','0','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    break_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.64  0.6 0.0344],'string',...
        'Breaker model                                                                                [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('1 = Roelvink1\n2 = Baldock\n3=Roelvink2\nkey: break'));
    break_value=uicontrol('unit','normalized','parent',fig','style','popup',...
        'position',[0.65 0.647 0.15 0.0344],'value',3,...
        'string','Roelvink|Baldock|Roelvink2|Roelvink & Daly','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    gamma_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.59  0.6 0.0344],'string',...
        'Breaker parameter                                                                         [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.4\nMax: 0.9\nkey: gamma'));
    gamma=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.68 0.593 0.12 0.0344],'string','0.55','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    gammax_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.54  0.6 0.0344],'string',...
        'Maximum waveheight over waterdepth                                         [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.4\nMax: 5\nkey: gammax'));
    gammax=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.68 0.543 0.12 0.0344],'string','2','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    alpha_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.49  0.6 0.0344],'string',...
        'Wave dissipation coefficient                                                          [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.5\nMax: 2\nkey: alpha'));
    alpha=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.68 0.493 0.12 0.0344],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    n_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.44  0.6 0.0344],'string',...
        'Power in Roelvink Model                                                               [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 5\nMax: 20\nkey: n'));
    n=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.68 0.443 0.12 0.0344],'string','10','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    roller_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.3  0.6 0.0344],'string',...
        'Roller Model                                                                                   [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Keyword not\nimplemented yet\nkey: roller'));
    roller=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.68 0.303 0.12 0.0344],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    beta_text=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.30 0.25  0.6 0.0344],'string',...
        'Breaker slope coefficient                                                                [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.05\nMax: 0.3\nkey: beta'));
    beta=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.68 0.253 0.12 0.0344],'string','0.15','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    handles{5,4}=[handles{5,4} act_bal_panel dissipat_panel roller_model_panel...
        wavint_text wavint scheme_text scheme wci_text...
        wci break_text break_value gamma_text gamma gammax_text...
        gammax alpha_text alpha n_text n roller_text ...
        roller beta_text beta];
    globalhand{1,8}={wavint; wci; gamma; gammax; alpha; n; roller; beta; scheme; break_value};
end

function calculate_chezy(varargin)
global cf C
set(C,'string',num2str(sqrt(9.81/str2double(get(cf,'string')))));

function windTAB(varargin)
global handles figurehandleX cor kt windclock tab_wind...
    tab_constants tab_flow tab_wave tab_sed_transp tab_morphoUP rhoa...
    Cd windv windth globalhand

windclock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{5,1},'visible','on'); set(handles{5,5},'visible','on');
set([tab_constants,tab_flow,tab_wave,tab_wind,tab_sed_transp,tab_morphoUP],...
    'foregroundcolor','k'); set(tab_wind,'foregroundcolor','b');
if isempty(handles{5,5})
    fig=getappdata(figurehandleX,'figurehandle');
    wind_panel=uipanel('unit','normalized','parent',fig,'Title','Wind','fontsize',8,...
        'position',[0.24 0.585  0.7 0.345],'backgroundcolor',cor);
    rhoaT_wind=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.83  0.6 0.0444],'string',...
        'Air Density                                                                                     [kg/m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: rhoa');
    rhoa=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.65 0.837 0.15 0.0444],'string','1.25','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    CdT_wind=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.76  0.6 0.0444],'string',...
        'Wind Drag Coefficient (Attention: > 50m/s)                                    [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.0001\nMax: 0.01\nkey: Cd'));
    Cd=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.65 0.767 0.15 0.0444],'string','0.002','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    windvT_wind=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.69  0.6 0.0444],'string',...
        'Wind Velocity                                                                                [m/s]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: windv');
    windv=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.65 0.697 0.15 0.0444],'string','5','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    windthT_wind=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.62  0.6 0.0444],'string',...
        'Wind Direction (Nautical Convention)                                           [deg]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: windth');
    windth=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.65 0.627 0.15 0.0444],'string','0','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    handles{5,5}=[handles{5,5} wind_panel rhoaT_wind rhoa CdT_wind...
        Cd windvT_wind windv windthT_wind windth];
    globalhand{1,9}={rhoa; Cd; windv; windth};
end

function sedtranspTAB(varargin)
global handles figurehandleX cor kt sedtranspclock tab_sed_transp...
    tab_constants tab_flow tab_wave tab_wind tab_morphoUP z0 ...
    facsl BRfac rhos por tsfac...
    facua waveform form thetanum smax...
    lws sws globalhand D50 D90 struct ne_layerPB ne_layer

sedtranspclock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{5,1},'visible','on'); set(handles{5,6},'visible','on');
if ishghandle(tab_morphoUP)
    set([tab_constants tab_flow tab_wave tab_wind tab_morphoUP],...
        'foregroundcolor','k'); set(tab_sed_transp,'foregroundcolor','b');
else
    set([tab_constants tab_flow tab_wave tab_wind],...
        'foregroundcolor','k'); set(tab_sed_transp,'foregroundcolor','b');
end
if isempty(handles{5,6})
    fig=getappdata(figurehandleX,'figurehandle');
    ST_panel=uipanel('unit','normalized','parent',fig,'Title',...
        'Sediment Transport','fontsize',8,...
        'position',[0.24 0.07  0.7 0.86],'backgroundcolor',cor);
    wformT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.83  0.6 0.0444],'string',...
        'Waveshape Model                                                                           [-]','fontsize',10,...
        'fontw','bold','value',1,'backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Ruessink & vanRijn\nkey: waveform'));
    waveform=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.55 0.841 0.25 0.04],'value',2,...
        'string','ruessink |vanthiel','fontsize',10,...
        'fontw','bold','SelectionHighlight','on','backgroundcolor',[1 1 1],...
        'horizontalalignment','right');
    formT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.78  0.6 0.0444],'string',...
        'Equilibrium Sedim. Concent. Form.                                                [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: form');
    form=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.62 0.791 0.18 0.04],'value',1,...
        'string','Soulsby\vanRijn|Vanthiel\vanRijn','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    thetanumT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.73  0.6 0.0444],'string',...
        'Scheme                                                                                           [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring','key: thetanum');
    thetanum=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.7 0.741 0.10 0.04],...
        'string','Upwind|Central','value',1,'fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    z0T_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.68  0.4 0.05444],'string',...
        'Zero Flow velocity level Sed. Conc. (Soulsby & vanRijn(1997)','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min:0.0001\nMax: 0.05\nkey: z0'));
    z0T_ST2=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.815 0.673  0.1 0.05444],'string',...
        '[m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    z0=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.691 0.10 0.04],'string','0.006','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    facslT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.63  0.6 0.0444],'string',...
        'Bed Slope Factor                                                                            [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min:0\nMax: 1.6\nkey: facsl'));
    facsl=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.641 0.10 0.04],'string','0','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    BRfacT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.58  0.6 0.0444],'string',...
        'Calibration Factor surface slope                                                     [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min:0\nMax: 1\nkey: BRfac'));
    BRfac=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.591 0.10 0.04],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    rhosT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.53  0.6 0.0444],'string',...
        'Density of Sediment (no pores)                                                       [kg/m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min:2400\nMax: 2800\nkey: rhos'));
    rhos=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.541 0.10 0.04],'string','2650','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    porT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.48  0.6 0.0444],'string',...
        'Porosity                                                                                           [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min:0.3\nMax: 0.5\nkey: por'));
    por=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.491 0.10 0.04],'string','0.4','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    smaxT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.43  0.6 0.0444],'string',...
        'Max shields value for overwash                                                      [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min:-1\nMax: 3\nkey: smax'));
    smax=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.7 0.441 0.10 0.04],'value',1,...
        'string','-1|0|1|2|3','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    tsfacT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.38  0.6 0.0444],'string',...
        'Max value for fall velocity                                                               [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min:0.01\nMax: 1\nkey: tsfac'));
    tsfac=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.391 0.10 0.04],'string','0.1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    facuaT_ST=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.33  0.6 0.0444],'string',...
        'Asymmetry transport                                                                       [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min:0\nMax: 1\nkey: facua'));
    facua=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.341 0.10 0.04],'string','0','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    d50T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.24  0.6 0.0444],'string',...
        'D50 sediment diameter                                                                   [m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('key: D50'));
    D50=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.251 0.10 0.04],'string','0.0002','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    d90T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.19  0.6 0.0444],'string',...
        'D90 sediment diameter                                                                   [m]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('key: D90'));
    D90=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.201 0.10 0.04],'string','0.0003','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    structT=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.14  0.6 0.0444],'string',...
        'Option for hard structures                                                               [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('key: struct'));
    struct=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.63 0.151 0.17 0.04],'string','No revetment|Multiple classes','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    nelayerT=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.09  0.6 0.0444],'string',...
        'Bed thickness','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('key: ne_layer'));
    ne_layer=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.645 0.09  0.2 0.0444],'string',...
        'Filename Unknown','fontsize',10,'enable','off',...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    ne_layerPB=uicontrol('unit','normalized','parent',fig,'style','push',...
        'position',[0.47 0.101 0.15 0.04],'string','Open File','fontsize',10,...
        'fontw','bold','SelectionHighlight','on',...
        'horizontalalignment','right','callback',@openDEPTH);
%     lws=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
%         'position',[0.37 0.16  0.2 0.0444],'string',...
%         'Longwave stirring','fontsize',10,'value',1,...
%         'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
%         'tooltipstring',sprintf('key: lws'));
%     sws=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
%         'position',[0.65 0.16  0.2 0.0444],'string',...
%         'Shortwave stirring','fontsize',10,'value',1,...
%         'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
%         'tooltipstring',sprintf('key: sws'));
    handles{5,6}=[handles{5,6} ST_panel wformT_ST waveform formT_ST...
        form thetanumT_ST thetanum z0T_ST z0T_ST2 ...
        z0 facslT_ST facsl BRfacT_ST BRfac ...
        rhosT_ST rhos porT_ST por smaxT_ST smax...
        tsfacT_ST tsfac facuaT_ST facua d50T D50 d90T D90 lws sws...
        structT struct nelayerT ne_layer ne_layerPB];
    globalhand{1,10}={z0; facsl; BRfac; rhos;	por; tsfac; facua; waveform; form; thetanum; smax};
end

function morphoTAB(varargin) % INCOMPLETE - TO REVISE (MULTIPLE SEDIMENT)
global handles figurehandleX cor kt morphoclock tab_morphoUP...
    tab_constants tab_flow tab_wave tab_wind tab_sed_transp...
    morfac morstart wetslp dryslp...
    hswitch morfacopt sourcesink globalhand

morphoclock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{5,1},'visible','on'); set(handles{5,7},'visible','on');
if ishghandle(tab_sed_transp)
    set([tab_constants,tab_flow,tab_wave,tab_wind,tab_sed_transp],...
        'foregroundcolor','k'); set(tab_morphoUP,'foregroundcolor','b');
else
    set([tab_constants,tab_flow,tab_wave,tab_wind],...
        'foregroundcolor','k'); set(tab_morphoUP,'foregroundcolor','b');
end
if isempty(handles{5,7})
    fig=getappdata(figurehandleX,'figurehandle');
    morpho_panel=uipanel('unit','normalized','parent',fig,'Title',...
        'Morphological Update and Avalanching','fontsize',8,...
        'position',[0.24 0.38  0.7 0.55],'backgroundcolor',cor);
    morfacT_mua=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.83  0.6 0.0444],'string',...
        'Morfological Factor                                                                         [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('key: morfac'));
    morfac=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.841 0.10 0.04],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    morstartT_mua=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.76  0.6 0.0444],'string',...
        'Start time of morfological updates                                                  [s]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('key: morstart'));
    morstart=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.771 0.10 0.04],'string','120','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    morfacoptT_mua=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.69  0.6 0.0444],'string',...
        'Type of morfac update (see manual pag. 38)                                  [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('key: morfacopt'));
    morfacopt=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.7 0.701 0.10 0.04],'value',2,...
        'string','Off|On','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    skT_mua=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.62  0.6 0.0444],'string',...
        'Type of morphological update                                                        [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('0 = gradient\n1 = source/sink\nkey: sourcesink'));
    sourcesink=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.65 0.631 0.15 0.04],'value',1,...
        'string','Gradient|Source/Sink','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    wetslpT_mua=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.55  0.6 0.0444],'string',...
        'Critical avalanching slope under water                                          [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.1\nMax: 1\nkey: wetslp'));
    wetslp=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.561 0.10 0.04],'string','0.3','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    dryslpT_mua=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.48  0.6 0.0444],'string',...
        'Critical avalanching slope above water                                         [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.1\nMax: 2\nkey: dryslp'));
    dryslp=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.491 0.10 0.04],'string','1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    hswitchT_mua=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.41  0.6 0.0444],'string',...
        'Water depth at interface above/below slope                                  [-]','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left',...
        'tooltipstring',sprintf('Min: 0.01\nMax: 1\nkey: hswitch'));
    hswitch=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.7 0.421 0.10 0.04],'string','0.1','fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'SelectionHighlight','on',...
        'horizontalalignment','right');
    handles{5,7}=[handles{5,7} morpho_panel morfacT_mua morfac ...
        morstartT_mua morstart morfacoptT_mua morfacopt...
        skT_mua sourcesink wetslpT_mua wetslp dryslpT_mua ...
        dryslp hswitchT_mua hswitch];
    globalhand{1,11}={morfac; morstart; wetslp; dryslp; hswitch; morfacopt; sourcesink};
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                          Main Button Boundaries                        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function boundaries_button(varargin) % INCOMPLETE - TO REVISE (BOUNDARIES)
global handles figurehandleX cor kt handles_MB flowbound_PB wavebound_PB...
    flow_bound_clock wave_bound_clock
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles_MB,'foregroundcolor','k'); set(handles_MB(6),'foregroundcolor','b');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{6,1},'visible','on');
if exist('flow_bound_clock','var') & ~exist('wave_bound_clock','var');
    set(handles{6,2},'visible','on');
elseif exist('wave_bound_clock','var') & ~exist('flow_bound_clock','var');
    set(handles{6,3},'visible','on');
elseif exist('flow_bound_clock','var') & exist('wave_bound_clock','var');
    aux=max([flow_bound_clock wave_bound_clock]);
    if aux==flow_bound_clock; set(handles{6,2},'visible','on'); elseif aux==wave_bound_clock; set(handles{6,3},'visible','on'); end
end
if isempty(handles{6,1})
    fig=getappdata(figurehandleX,'figurehandle');
    boundaries_panel=uipanel('unit','normalized','parent',fig,'Title',...
        'Boundaries Conditions','fontsize',8,...
        'position',[0.24 0.855  0.7 0.125],'backgroundcolor',cor);
    flowbound_PB=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.30 0.89  0.25 0.0444],'string',...
        'Flow Boundaries','fontsize',10,...
        'fontw','bold','horizontalalignment','center',...
        'callback',@flow_bound);
    wavebound_PB=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.63 0.89  0.25 0.0444],'string',...
        'Wave Boundaries','fontsize',10,...
        'fontw','bold','horizontalalignment','center',...
        'callback',@wave_bound);
    handles{6,1}=[handles{6,1} boundaries_panel flowbound_PB wavebound_PB];
end

function flow_bound(varargin)
global handles figurehandleX cor kt flow_bound_clock flowbound_PB wavebound_PB...
    fbound1_Pop fbound1_PopCon fbound2_Pop fbound2_PopCon fbound3_Pop fbound3_PopCon...
    fbound4_Pop fbound4_PopCon B01 B2 UISAVE UISAVEAS boundariesF_panel boundariesW_panel ...
    globalhand
set(flowbound_PB,'foregroundcolor','b'); set(wavebound_PB,'foregroundcolor','k');
flow_bound_clock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{6,1},'visible','on'); set(handles{6,2},'visible','on');
if isempty(handles{6,2})
    fig=getappdata(figurehandleX,'figurehandle');
    boundariesF_panel=uipanel('unit','normalized','parent',fig,'Title',...
        'Specify Flow Boundaries','fontsize',8,...
        'position',[0.24 0.4  0.7 0.4],'backgroundcolor',cor);
    fboundary=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.475 0.71  0.16 0.0444],'string',...
        'Boundary','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    fboundaryCond=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.69 0.71  0.16 0.0444],'string',...
        'Boundary Condition','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    fbound1T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.65  0.16 0.0444],'string',...
        'Boundary 1','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    fbound1_PopCon=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.7 0.655  0.14 0.0444],'string',...
        'None|abs_1d|abs_2d|wall|wlevel|nonh_1d','Enable','on',...
        'fontsize',10,'backgroundcolor',[1 1 1],'value',2,...
        'fontw','bold','horizontalalignment','center'); B01=1;
    fbound1_Pop=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.45 0.655  0.14 0.0444],'value',1,'string',...
        'front|ARC|order|carspan|back|left|right|epsi',...
        'fontsize',10,'backgroundcolor',[1 1 1],...
        'fontw','bold','horizontalalignment','center','callback',@fbound00_Cond); %}
    B2=5;
    fbound2T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.58  0.16 0.0444],'string',...
        'Boundary 2','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    fbound2_PopCon=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.7 0.585  0.14 0.0444],'string',...
        'None|wall|abs_1d|abs_2d|wlevel','Enable','on',...
        'fontsize',10,'backgroundcolor',[1 1 1],'value',2,...
        'fontw','bold','horizontalalignment','center');
    fbound2_Pop=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.45 0.585  0.14 0.0444],'string',...
        'front|ARC|order|carspan|back|left|right|epsi','value',5,...
        'fontsize',10,'backgroundcolor',[1 1 1],...
        'fontw','bold','horizontalalignment','center','callback',@fbound00_Cond);
    fbound3T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.51  0.16 0.0444],'string',...
        'Boundary 3','fontsize',10,'foregroundcolor',[.5 .5 .5],...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    fbound3_Pop=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.45 0.515  0.14 0.0444],'string',...
        'None|front|ARC|order|carspan|back|left|right|epsi',...
        'fontsize',10,'foregroundcolor',[.5 .5 .5],...
        'fontw','bold','horizontalalignment','center','callback',@fbound00_Cond,'enable','on');
    fbound3_PopCon=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.7 0.515  0.14 0.0444],'string',...
        'None','Enable','off',...
        'fontsize',10,'backgroundcolor',[1 1 1],...
        'fontw','bold','horizontalalignment','center');
    fbound4T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.30 0.44  0.16 0.0444],'string',...
        'Boundary 4','fontsize',10,'foregroundcolor',[.5 .5 .5],...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    fbound4_Pop=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.45 0.445  0.14 0.0444],'string',...
        'None|front|ARC|order|carspan|back|left|right|epsi',...
        'fontsize',10,'foregroundcolor',[.5 .5 .5],...
        'fontw','bold','horizontalalignment','center','callback',@fbound00_Cond,'enable','on');
    fbound4_PopCon=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.7 0.445  0.14 0.0444],'string',...
        'None','Enable','off',...
        'fontsize',10,'backgroundcolor',[1 1 1],...
        'fontw','bold','horizontalalignment','center');
    handles{6,2}=[handles{6,2} boundariesF_panel fboundary fboundaryCond fbound1T ...
        fbound1_Pop fbound1_PopCon fbound2T fbound2_Pop fbound2_PopCon fbound3T...
        fbound3_Pop fbound3_PopCon fbound4T fbound4_Pop fbound4_PopCon];
    if ishghandle(boundariesW_panel) & ishghandle(boundariesF_panel);
        set([UISAVE,UISAVEAS],'enable','on');
    end
    
    globalhand{1,12}={fbound1_PopCon; fbound2_PopCon};
end

function fbound00_Cond(hObj,varargin)
global figurehandleX fbound1_Pop fbound1_PopCon fbound2_Pop fbound2_PopCon ...
        fbound3_Pop fbound3_PopCon fbound4_PopCon
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
if hObj==fbound1_Pop
    pop=fbound1_PopCon; n0=0;
elseif hObj==fbound2_Pop
    pop=fbound2_PopCon; n0=0;
elseif hObj==fbound3_Pop
    pop=fbound3_PopCon; n0=1;
elseif hObj==fbound4_PopC
    pop=fbound4_PopCon; n0=1;
end

if get(hObj,'value')== 1+n0 %front
    set(pop,'enable','on','backgroundcolor',[1 1 1],'string',...
        'None|abs_1d|abs_2d|wall|wlevel|nonh_1d','value',2);
elseif get(hObj,'value')== 2+n0 %ARC
    set(pop,'enable','on','backgroundcolor',[1 1 1],'string',...
        'On|Off','value',1);
elseif get(hObj,'value')== 3+n0 %order
    set(pop,'enable','on','backgroundcolor',[1 1 1],'string',...
        '2nd order|1st order','value',1);
elseif get(hObj,'value')== 4+n0 %carspan
    set(pop,'enable','on','backgroundcolor',[1 1 1],'string',...
        '0 (manual)|1 (manual)','value',1);
elseif get(hObj,'value')== 5+n0 %back
    set(pop,'enable','on','backgroundcolor',[1 1 1],'string',...
        'None|wall|abs_1d|abs_2d|wlevel','value',2);
elseif get(hObj,'value')== 6+n0 %left
    set(pop,'enable','on','backgroundcolor',[1 1 1],'string',...
        'neumann|wall','value',1);
elseif get(hObj,'value')== 7+n0 %right
    set(pop,'enable','on','backgroundcolor',[1 1 1],'string',...
        'neumann|wall','value',1);
elseif get(hObj,'value')== 8+n0 %epsi
    set(pop,'enable','on','backgroundcolor',[1 1 1],'string',...
        'Obsolete (man.)','value',1);
end

function wave_bound(varargin)
global handles figurehandleX cor kt wave_bound_clock flowbound_PB wavebound_PB ...
    instat bcfile wfile_open boundariesW_panel wboundaryI UISAVE UISAVEAS...
    boundariesF_panel
set(flowbound_PB,'foregroundcolor','k'); set(wavebound_PB,'foregroundcolor','b');
wave_bound_clock=datenum(clock);
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
set(handles{6,1},'visible','on'); set(handles{6,3},'visible','on');
if isempty(handles{6,3})
    fig=getappdata(figurehandleX,'figurehandle');
    boundariesW_panel=uipanel('unit','normalized','parent',fig,'Title',...
        'Specify Wave Boundaries','fontsize',8,...
        'position',[0.24 0.25  0.7 0.55],'backgroundcolor',cor);
    wboundaryI=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.26 0.7  0.1 0.0444],'string','Instat =',...
        'backgroundcolor',cor,'fontsize',10,...
        'fontw','bold' ,'horizontalalignment','left');
    bcfile=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.57 0.635  0.35 0.0355],'string','Filename Unknown','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left','enable','off');
    wfile_open=uicontrol('unit','normalized','parent',fig,'style','pushbutton',...
        'position',[0.3 0.64  0.25 0.0355],'string','Open BCfile','fontsize',10,...
        'fontw','bold','callback',@wave_boundaryFILE,'max',1,'enable','off');
    instat=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.34 0.705  0.57 0.0444],'value',1,'string',...
        ['None|0 - Stationary wave boundary condition (sea state)|',...
        '1 - Bichromatic (two wave component) waves|',...
        '2 - First-order timeseries of wave (outside XBeach)|',...
        '3 - Second-order timeseries of wave (outside XBeach)|',...
        '4 - Wave groups generated using a parametric (Jonswap) spectrum)|',...
        '5 - Wave groups generated using a SWAN 2D output file|',...
        '6 - Wave groups generated using a formated file|',...
        '7 - Reuse of wave conditions|',...
        '8 - Boundary conditions for nonhydrostatic option|',...
        '9 - No wave boundary conditions|',...
        '40 - A sequence of stationary conditions (sea states)|',...
        '41 - A sequence of time-varying wave groups'],'fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','left',...
        'callback',@wave_tables);
    
    if ishghandle(boundariesW_panel) & ishghandle(boundariesF_panel);
        set([UISAVE,UISAVEAS],'enable','on');
    end
    handles{6,3}=[handles{6,3} boundariesW_panel wboundaryI bcfile wfile_open instat];
end

function wave_tables(varargin)
global handles figurehandleX cor kt instat bcfile wfile_open jon_table...
    boundariesW_panel wboundaryI
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
fig=getappdata(figurehandleX,'figurehandle');
h=get(instat,'value');
if h==6 | h==13
    set([bcfile,wfile_open],'enable','on');
    if h==6
        jonT={'Hm0';'fp';'mainang';'gammajsp';'s';'fnyq'};
        for g=1:6; jonT{g,2}='';end;
        if ishghandle(jon_table)
            delete(jon_table);
        end
        jon_table=uitable('unit','normalized','parent',fig,'data',jonT,...
            'ColumnName',{'Parameter','Value'},'RowName',[],...
            'position',[0.5 0.3 0.19 0.3],'fontsize',10,...
            'columnformat',{'char','numeric'},'columneditable',...
            [false true],'ColumnWidth','auto');
    elseif h==13
        jonT={'Hm0','Tp','Angle','Gamma','Spreading','Duration(s)','Timestep'};
        for g=2:5; for k=1:7; jonT{g,k}='';end;end;
        if ishghandle(jon_table)
            delete(jon_table);
        end
        jon_table=uitable('unit','normalized','parent',fig,'data',jonT(2:5,:),...
            'ColumnName',jonT(1,:),'RowName',[],...
            'position',[0.26 0.3 0.662 0.3],'fontsize',10,...
            'columnformat',{'numeric','numeric','numeric','numeric','numeric','numeric','numeric'},...
            'columneditable',[true true true true true true true],'ColumnWidth','auto');
    end
    handles{6,3}=[boundariesW_panel wboundaryI instat jon_table wfile_open bcfile];
elseif h~=6 | h~=13
    if ishghandle(jon_table)
        delete(jon_table);
    end
    set([bcfile,wfile_open],'enable','off');
    set(bcfile,'string','Filename Unknown');
end

function wave_boundaryFILE(varargin)
global handles figurehandleX cor kt instat bcfile wfile_open boundariesW_panel...
    wboundaryI jon_table
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
fig=getappdata(figurehandleX,'figurehandle');
if get(instat,'value')==6
    [file,path]=uigetfile({'*.*','jonswap (*.*)'},'Pick a BCfile');
    if file==0
        set(bcfile,'String','Filename Unknown');
    else
        fid=fopen([path,file]);
        jon=fread(fid,'*char'); jon=strread(jon,'%s','whitespace','\b');
        if size(jon,1)>=3
            for g=1:size(jon,1)
                aux=strfind(jon{g,1},'=');
                jonT{g,1}=jon{g,1}(1:aux-1); jonT{g,2}=str2num(jon{g,1}(aux+1:end));
            end
            if ishghandle(jon_table)
                delete(jon_table);
            end
            jon_table=uitable('unit','normalized','parent',fig,'data',jonT,...
                'ColumnName',{'Parameter','Value'},'RowName',[],...
                'position',[0.5 0.3 0.19 0.3],'fontsize',10,...
                'columnformat',{'char','numeric'},'columneditable',...
                [false true],'ColumnWidth','auto');
            fclose(fid);
            set(bcfile,'string',file);
            handles{6,3}=[boundariesW_panel wboundaryI instat jon_table wfile_open bcfile];
        else
            alertFigure('File not Supported!')
        end
    end
elseif get(instat,'value')==13
    [file,path]=uigetfile({'*.lst;*.txt','Jonswap Files (*.lst,*.txt)'},'Pick a BCfile');
    if file==0
        set(bcfile,'String','Filename Unknown');
    else       
        fid=fopen([path,file]);
        jon=fread(fid,'*char'); jon=strread(jon,'%s','whitespace','\b');
        jonTc={'Hm0','Tp','Angle','Gamma','Spreading','Duration(s)','Timestep'};
        if size(jon,1)>=3
            for g=1:size(jon,1)
                aux=strfind(jon{g,1},' '); k=1;
                while k<=length(aux)-1
                    if aux(k+1) - aux(k)>3
                        if k==1
                            jonT{g,k}=str2num(jon{g,1}(1:aux(k)-1));
                        else
                            jonT{g,k}=str2num(jon{g,1}(aux(k)+1:aux(k+1)-1));
                        end
                        k=k+1;
                    else
                        if k==1
                            jonT{g,k}=str2num(jon{g,1}(1:aux(k+1)-1));
                        else
                            jonT{g,k}=str2num(jon{g,1}(aux(k)+1:aux(k+2)-1));
                        end
                        k=k+1;
                    end
                end
            end
            if ishghandle(jon_table)
                delete(jon_table);
            end
            
            jon_table=uitable('unit','normalized','parent',fig,'data',jonT(1:end,:),...
                'ColumnName',jonTc(1,:),'RowName',[],...
                'position',[0.26 0.3 0.662 0.3],'fontsize',10,...
                'columnformat',{'numeric','numeric','numeric','numeric','numeric','numeric','numeric'},...
                'columneditable',[true true true true true true true],'ColumnWidth','auto');
            fclose(fid);
            set(bcfile,'string',file);
            handles{6,3}=[boundariesW_panel wboundaryI instat jon_table wfile_open bcfile];
        else
            alertFigure('File not Supported!')
        end
    end
end

%
% function openENC(varargin)
% global d3denT_open
% [file]=uigetfile({'*.enc','Enclosure (*.enc)'},'Pick a File');
% if file==0
%     set(d3denT_open,'String','Filename Unknown');
% else
%     set(d3denT_open,'String',file);
% end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%        Main Button Output  - INCOMPLETE - TO REVISE (POINT VAR.)       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function output_button(varargin)
global handles figurehandleX cor kt handles_MB MB_out tstop aux1 stop_time_T...
    handles_Glob handles_Tavg handles_Point outGlob_CB outTimeAvg_CB output_Tavgpanel...
    output_Globpanel output_Pointpanel ...
    outPoint_CB outGlobAll_CB outGlobZb_CB outGlobZs_CB...
    outGlobH_CB outGlobEu_CB outGlobthMean_CB outGlobsedero_CB outGlobdzav_CB...
    outGlobsusg_CB outGlobsvsg_CB outGlobsubg_CB outGlobsvbg_CB...
    outTavgAll_CB outTavgbH_CB outTavgEu_CB...
    outTavgsusg_CB outTavgsvsg_CB outTavgsubg_CB outTavgsvbg_CB...
    outPointAll_CB outPointzs_CB outPointH_CB outPointEu_CB...
    outGlobINTERV_T tintg outTavgINTERV_T tintm...
    outPointINTERV_T tintp start_time_T tstart outputformat
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
set(handles_MB,'foregroundcolor','k'); set(handles_MB(9),'foregroundcolor','b');
for k=1:kt
    for g=1:length(handles(:,1))
        if ~isempty('handles'); aux=handles{g,k}; set(aux,'visible','off'); end
    end
end
if ~isempty(aux1) & strcmp(get(tstop,'string'),aux1)==0
    set(stop_time_T,'string',['Stop Time:  ',get(tstop,'string'),'  [s]']);
end
set(handles{9,1},'visible','on');
if isempty(handles{9,1})
    fig=getappdata(figurehandleX,'figurehandle');
    output_panel=uipanel('unit','normalized','parent',fig,'Title',...
        'Output Configuration','fontsize',8,...
        'position',[0.24 0.31  0.7 0.67],'backgroundcolor',cor);
    output_Globpanel=uipanel('unit','normalized','parent',fig,'Title',...
        'Global Variables','fontsize',8,'foregroundcolor',[.5 .5 .5],...
        'position',[0.28 0.37  0.285 0.435],'backgroundcolor',cor);
    output_Tavgpanel=uipanel('unit','normalized','parent',fig,'Title',...
        'Time-Averaged Variables','fontsize',8,'foregroundcolor',[.5 .5 .5],...
        'position',[0.61 0.53  0.285 0.275],'backgroundcolor',cor);
    output_Pointpanel=uipanel('unit','normalized','parent',fig,'Title',...
        'Point Variables','fontsize',8,'foregroundcolor',[.5 .5 .5],...
        'position',[0.61 0.335  0.285 0.185],'backgroundcolor',cor);
    outForm_T=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.28 0.88  0.2 0.0444],'string',...
        'Output Format','fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    outputformat=uicontrol('unit','normalized','parent',fig,'style','popup',...
        'position',[0.42 0.888  0.1 0.0444],'value',2,'string',...
        'None|netcdf','fontsize',10,'backgroundcolor',[1 1 1],...
        'fontw','bold','horizontalalignment','center');
    start_time_T=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.54 0.88  0.2 0.0444],'string',...
        ['Start Time:            [s]'],'fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left');
    tstart=uicontrol('unit','normalized','parent',fig','style','edit',...
        'position',[0.633 0.888  0.05 0.0444],'string',...
        ['0'],'fontsize',10,...
        'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','right');
    stop_time_T=uicontrol('unit','normalized','parent',fig','style','text',...
        'position',[0.73 0.88  0.2 0.0444],'string',...
        ['Stop Time:  ',get(tstop,'string'),'  [s]'],'fontsize',10,...
        'fontw','bold','backgroundcolor',cor,'horizontalalignment','left'); aux1=get(tstop,'string');
    outGlob_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.825  0.2 0.0444],'string',...
        'Global variables','fontsize',10,'backgroundcolor',cor,...
        'fontw','bold','horizontalalignment','left','callback',@globalVars);
    outTimeAvg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.473 0.825  0.3 0.0444],'string',...
        'Time-Averaged Global variables','fontsize',10,'backgroundcolor',cor,...
        'fontw','bold','horizontalalignment','left','callback',@globalVars);
    outPoint_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.77 0.825  0.15 0.0444],'string',...
        'Point variables','fontsize',10, 'fontw','bold','backgroundcolor',cor,...
        'horizontalalignment','left','enable','off','callback',@define_outPoint);
    
    outGlobAll_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.38 0.745  0.13 0.04],'string',...
        'Save all','fontsize',10,'backgroundcolor',cor,'enable','off',...
        'fontw','bold','horizontalalignment','left','callback',@globalVars);
    outGlobZb_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.715  0.2 0.037],'value',1,'string',...
        'Bed Level','fontsize',8,'backgroundcolor',cor,'enable','off',...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobZs_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.685  0.2 0.037],'value',1,'string',...
        'Water Level','fontsize',8,'backgroundcolor',cor,'enable','off',...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobH_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.655  0.2 0.037],'value',1,'string',...
        'Wave height','fontsize',8,'backgroundcolor',cor,'enable','off',...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobEu_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.625  0.25 0.037],'value',1,'enable','off','string',...
        'Eulerian mean x/y velocity cell center','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobthMean_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.595  0.2 0.037],'value',1,'string',...
        'Mean wave angle','fontsize',8,'backgroundcolor',cor,'enable','off',...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobsedero_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.565  0.2 0.037],'value',1,'string',...
        'Cum. sedimentation/erosion','fontsize',8,'backgroundcolor',cor,'enable','off',...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobdzav_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.535  0.23 0.037],'value',1,'enable','off','string',...
        'Bed level change due avalanching','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobsusg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.505  0.23 0.037],'value',1,'enable','off','string',...
        'Suspended sediment transport (u)','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobsvsg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.475  0.23 0.037],'value',1,'enable','off','string',...
        'Suspended sediment transport (v)','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobsubg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.445  0.23 0.037],'value',1,'enable','off','string',...
        'Bed sediment transport (u)','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobsvbg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.30 0.415  0.23 0.037],'value',1,'enable','off','string',...
        'Bed sediment transport (v)','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outGlobINTERV_T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.32 0.379  0.2 0.03],'enable','off','string',...
        'Interval output (s)','fontsize',9,'backgroundcolor',cor,...
        'fontw','bold','horizontalalignment','left','tooltipstring','tintg');
    tintg=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.45 0.38  0.08 0.03],'enable','off','string',...
        '60','fontsize',9,'backgroundcolor',[1 1 1],...
        'fontw','bold','horizontalalignment','right','callback','');    
    handles_Glob=[outGlobAll_CB outGlobZb_CB outGlobZs_CB outGlobH_CB outGlobEu_CB ...
        outGlobthMean_CB  outGlobsedero_CB  outGlobdzav_CB...
        outGlobINTERV_T tintg outGlobsusg_CB outGlobsvsg_CB outGlobsubg_CB outGlobsvbg_CB];
    
    outTavgAll_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.69 0.745  0.13 0.04],'string',...
        'Save all','fontsize',10,'backgroundcolor',cor,'enable','off',...
        'fontw','bold','horizontalalignment','left','callback',@globalVars);
    outTavgbH_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.715  0.2 0.037],'value',1,'string',...
        'Wave height','fontsize',8,'backgroundcolor',cor,'enable','off',...
        'fontw','normal','horizontalalignment','left','callback','');
    outTavgEu_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.685  0.25 0.037],'value',1,'enable','off','string',...
        'Eulerian mean x/y velocity cell center','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outTavgsusg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.655  0.23 0.037],'value',1,'enable','off','string',...
        'Suspended sediment transport (u)','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outTavgsvsg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.625  0.23 0.037],'value',1,'enable','off','string',...
        'Suspended sediment transport (v)','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outTavgsubg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.595  0.23 0.037],'value',1,'enable','off','string',...
        'Bed sediment transport (u)','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outTavgsvbg_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.565  0.23 0.037],'value',1,'enable','off','string',...
        'Bed sediment transport (v)','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outTavgINTERV_T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.65 0.539  0.2 0.03],'enable','off','string',...
        'Interval output (s)','fontsize',9,'backgroundcolor',cor,...
        'fontw','bold','horizontalalignment','left','tooltipstring','tintg');
    tintm=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.78 0.54  0.08 0.03],'enable','off','string',...
        '3600','fontsize',9,'backgroundcolor',[1 1 1],...
        'fontw','bold','horizontalalignment','right','callback','');
    handles_Tavg=[outTavgAll_CB outTavgbH_CB outTavgEu_CB outTavgINTERV_T tintm...
        outTavgsusg_CB outTavgsvsg_CB outTavgsubg_CB outTavgsvbg_CB];
    
    outPointAll_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.69 0.46  0.13 0.04],'string',...
        'Save all','fontsize',10,'backgroundcolor',cor,'enable','off',...
        'fontw','bold','horizontalalignment','left','callback','');
    outPointzs_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.44  0.2 0.029],'string',...
        'Water level','fontsize',8,'backgroundcolor',cor,'enable','off',...
        'fontw','normal','horizontalalignment','left','callback','');
    outPointH_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.409  0.2 0.033],'string',...
        'Wave height','fontsize',8,'backgroundcolor',cor,'enable','off',...
        'fontw','normal','horizontalalignment','left','callback','');
    outPointEu_CB=uicontrol('unit','normalized','parent',fig,'style','checkbox',...
        'position',[0.63 0.38  0.25 0.033],'enable','off','string',...
        'Eulerian mean x/y velocity cell center','fontsize',8,'backgroundcolor',cor,...
        'fontw','normal','horizontalalignment','left','callback','');
    outPointINTERV_T=uicontrol('unit','normalized','parent',fig,'style','text',...
        'position',[0.65 0.344  0.2 0.03],'enable','off','string',...
        'Interval output (s)','fontsize',9,'backgroundcolor',cor,...
        'fontw','bold','horizontalalignment','left','tooltipstring','tintg');
    tintp=uicontrol('unit','normalized','parent',fig,'style','edit',...
        'position',[0.78 0.345  0.08 0.03],'enable','off','string',...
        '2','fontsize',9,'backgroundcolor',[1 1 1],...
        'fontw','bold','horizontalalignment','right','callback','');    
    handles_Point=[outPointAll_CB outPointzs_CB outPointH_CB outPointEu_CB outPointINTERV_T...
        tintp];
    
    handles{9,1}=[handles{9,1} output_panel outForm_T outputformat stop_time_T ...
        outGlob_CB outTimeAvg_CB outPoint_CB handles_Glob handles_Tavg handles_Point...
        output_Pointpanel output_Tavgpanel output_Globpanel start_time_T tstart];
end

function globalVars(hObj,event)
global output_Globpanel handles_Glob outGlob_CB outTimeAvg_CB figurehandleX...
    outGlobZb_CB outGlobZs_CB outGlobH_CB outGlobEu_CB ...
    outGlobthMean_CB  outGlobsedero_CB  outGlobdzav_CB...
    output_Tavgpanel handles_Tavg outTavgbH_CB outTavgEu_CB outTavgAll_CB outGlobAll_CB
glob_hand=[outGlobZb_CB outGlobZs_CB outGlobH_CB outGlobEu_CB ...
    outGlobthMean_CB  outGlobsedero_CB  outGlobdzav_CB];
set(figurehandleX,'name',['XBeach GUI  --  ',fsize(pwd),'*']);
if hObj==outGlob_CB
    if get(outGlob_CB,'value')==1;
        set(handles_Glob,'enable','on');
        set(output_Globpanel,'foregroundcolor',[0 0 0]);
        set(glob_hand,'value',1); set(outGlobAll_CB,'value',0);
    elseif get(outGlob_CB,'value')==0;
        set(handles_Glob,'enable','off');
        set(output_Globpanel,'foregroundcolor',[.5 .5 .5]);
    end
elseif hObj == outTimeAvg_CB
    if get(outTimeAvg_CB,'value')==1;
        set(handles_Tavg,'enable','on');
        set(output_Tavgpanel,'foregroundcolor',[0 0 0]);
        set([outTavgbH_CB outTavgEu_CB],'value',1); set(outTavgAll_CB,'value',0);
    elseif get(outTimeAvg_CB,'value')==0;
        set(handles_Tavg,'enable','off');
        set(output_Tavgpanel,'foregroundcolor',[.5 .5 .5]);
    end
elseif hObj == outGlobAll_CB
    if get(outGlobAll_CB,'value')==1
        set(glob_hand,'value',0);
    elseif get(outGlobAll_CB,'value')==0
        set(glob_hand,'value',1);
    end
elseif hObj == outTavgAll_CB
    if get(outTavgAll_CB,'value')==1
        set([outTavgbH_CB outTavgEu_CB],'value',0);
    elseif get(outTavgAll_CB,'value')==0
        set([outTavgbH_CB outTavgEu_CB],'value',1);
    end
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                          Visualization Area                            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function viewarea(varargin)
global cor xgrid ygrid B1 ax1 PLOT_LDB clrmap_choose fViewarea K h2 h1 ...
    caxisMIN caxisMAX gr01 gr02 LDB1 statusbarFvArea
buttons={'New Figure','Open File','Edit Plot','Save Figure','Print Figure','Hide Plot Tools',...
    'Show Plot Tools','Insert Legend','Data Cursor','Rotate 3D',...
    'Brush/Select Data','Link Plot','Show Plot Tools and Dock Figure'};
% buttons={'New Figure','Open File','Save Figure','Print Figure','Hide Plot Tools',...
%     'Show Plot Tools','Insert Legend','Insert Colorbar','Data Cursor','Rotate 3D',...
%     'Brush/Select Data','Link Plot','Show Plot Tools and Dock Figure'};
% buttons={'Pan','Edit Plot','Zoom in','Zoom Out'};
width=400; height=250; set(0, 'Units', 'points'); pos=get(0,'screensize');
fViewarea = figure('Units', 'points','WindowStyle', 'normal', ...
    'Position', [pos(3)/2-width/2 pos(4)/2-height/2 width height],'NumberTitle','off',...
    'Tag','ViewArea','Interruptible', 'off',...
    'DockControls', 'off','Visible','on','name','Domain View','color',cor,...
    'ResizeFcn',@maximized_window,'KeyPressFcn',@move_axis_key);
set(fViewarea,'renderer','OpenGL','renderermode','manual');
colordef(fViewarea,'black');
modifyLogo(fViewarea);
% uimenu(f,'label','Land Boundary');

% handles uimenu figure
hUiMenu=get(findall(fViewarea,'type','uimenu'),'tag');
% handles toolbar tag names
hToolBar=get(findall(findall(fViewarea,'tag','FigureToolBar')),'tag');
% set(h2,'visible','on','ClickedCallback',@colorbar_on); K=1;
% set(h2,'OffCallback',@colorbar_off);

% clear uimenu
for g=1:length(hUiMenu(:,1));
    aux=findall(fViewarea,'tag',hUiMenu{g,1});
    set(aux,'visible','off');
end

ax1=axes; set(ax1, 'LooseInset', [0,0,0,0],'hittest','off');
Fi=uimenu(fViewarea,'label','File');
Vi=uimenu(fViewarea,'label','View');
Ed=uimenu(fViewarea,'label','Edit');

ldbopen=uimenu(Fi,'label','Open Land Boundary','callback',@carregaLDB);
uimenu(Fi,'label','Exit','callback','closereq');

cSET=uimenu(Ed,'label','Bathymetry Limits','callback',@caxisSET);

Acolor=uimenu(Ed,'label','Colors');
uimenu(Acolor,'label','BackGround','callback',@sel_color_bg);
uimenu(Acolor,'label','Land Boundary','callback',@sel_color_LDB);
clmSET=uimenu(fViewarea,'label','Colormap'); clrmap=uimenu(clmSET,'Label','Colors');
uimenu(clrmap,'label','Jet','callback','colormap(''jet'')');
uimenu(clrmap,'label','HSV','callback','colormap(''hsv'')');
uimenu(clrmap,'label','Hot','callback','colormap(''hot'')');
uimenu(clrmap,'label','Cool','callback','colormap(''cool'')');
uimenu(clrmap,'label','Spring','callback','colormap(''spring'')');
uimenu(clrmap,'label','Summer','callback','colormap(''summer'')');
uimenu(clrmap,'label','Autumn','callback','colormap(''autumn'')');
uimenu(clrmap,'label','Winter','callback','colormap(''winter'')');
uimenu(clrmap,'label','Gray','callback','colormap(''gray'')');
uimenu(clrmap,'label','Bone','callback','colormap(''bone'')');
uimenu(clrmap,'label','Copper','callback','colormap(''copper'')');
uimenu(clrmap,'label','Pink','callback','colormap(''pink'')');
uimenu(clrmap,'label','Lines','callback','colormap(''lines'')');
uimenu(clmSET,'label','Invert','callback',...
    'global fViewarea invCLR; colormap(flipud(get(fViewarea,''colormap'')))');
shadSET=uimenu(Vi,'label','Shading');
shadSETflat=uimenu(shadSET,'label','Flat','callback','shading flat');
shadSETinterp=uimenu(shadSET,'label','Interp','callback','shading interp');
gridIO=uimenu(Vi,'label','Grid');
uimenu(gridIO,'label','On','callback',...
    'global gr01 gr02;set(gr01,''visible'',''on'');set(gr02,''visible'',''on'')');
uimenu(gridIO,'label','Off','callback',...
    'global gr01 gr02;set(gr01,''visible'',''off'');set(gr02,''visible'',''off'')');
set(fViewarea,'windowButtonMotionFcn',@mouse_pointer);
set(fViewarea,'windowButtonUpFcn',@maximized_window);
statusbarFvArea=uicontrol('unit','normalized','parent',fViewarea,...
    'style','text','backgroundcolor',cor,'position',[0 0 1 0.04],...
    'string','Xbeach GUI Visualization Area - Waiting');
set(fViewarea,'toolbar','figure');

% clear some toolbar buttons
a=findall(fViewarea);
for g=1:length(buttons)
    aux=findall(a,'tooltipstring',buttons{g});
    set(aux,'visible','off');
end

% h1=findall(fViewarea,'tag','FigureToolBar');
% h2=findall(h1,'tooltipstring','Zoom In');
set(h2,'RightClickAction','InverseZoom'); fontDefault=get(0,'FactoryAxesFontSize');
if ~isempty(xgrid) & ~isempty(ygrid)
    if ~isempty(B1);
        pcolor(xgrid,ygrid,B1); shading interp; axis equal; hold on; colormap(flipud(colormap));
        gr01=plot(xgrid,ygrid,'k','linew',0.2);
        gr02=plot(xgrid',ygrid','k','linew',0.2); set(ax1,'color','none'); %colorbar;
        plot(xgrid(1,1),ygrid(1,1),'o','markersize',fontDefault,'markerfacecolor','k',...
            'markeredgecolor','y');
    else
        axis off;
        alertFigure('Load Bathymetry Before!');
    end
else
    axis off;
end

function mouse_pointer(varargin)
global ax1 statusbarFvArea
C=get(ax1,'CurrentPoint');
set(statusbarFvArea,'string',...
    ['Xbeach GUI Visualization Area - X: ',sprintf('%2.3f',C(1,1)),...
    ' | Y: ',sprintf('%2.3f',C(1,2)),' [m]']);

function maximized_window(varargin)
global fViewarea statusbarFvArea
h=get(fViewarea,'javaframe');
if get(h,'Maximized')==1
    set(statusbarFvArea,'position',[0 0 1 0.016]);
else
    set(statusbarFvArea,'position',[0 0 1 0.037]);
end

function move_axis_key(fViewarea,event)
global ax1
switch event.Key
    case 'rightarrow'
        aux=get(ax1,'xlim'); set(ax1,'xlim',aux+[aux(1)*0.002 aux(2)*0.002]);
    case 'leftarrow'
        aux=get(ax1,'xlim'); set(ax1,'xlim',aux+[-aux(1)*0.002 -aux(2)*0.002]);
    case 'uparrow'
        aux=get(ax1,'ylim'); set(ax1,'ylim',aux+[aux(1)*0.0002 aux(2)*0.0002]);
    case 'downarrow'
        aux=get(ax1,'ylim'); set(ax1,'ylim',aux+[-aux(1)*0.0002 -aux(2)*0.0002]);
    otherwise
end

% invCLR=uimenu(fViewarea,'label','Invert Colormap','callback',@(fViewarea)colormap(flipud(get(fViewarea,'colormap')))');

% JEditorPane
% Add a "Next phase" button to the right of the text
% jb = javax.swing.JButton('Next phase >');
% jbh = handle(jb,'CallbackProperties');
% set(jbh, 'ActionPerformedCallback', @nextPhaseFunction);
% statusbarObj.add(jb,'East');
% %note: we might need jRootPane.setStatusBarVisible(0)
% % followed by jRootPane.setStatusBarVisible(1) to repaint
%
% % Add a simple Matlab uicontrol, obscured by the status-bar
% hb = uicontrol('string','click me!', 'position',[10,15,70,30]);

% STATUS BAR
% hFig=figure;
% jFrame = get(hFig,'JavaFrame');
% jRootPane = jFrame.fFigureClient.getWindow;
% statusbarObj = com.mathworks.mwswing.MJStatusBar;
% jRootPane.setStatusBar(statusbarObj);
% statusbarObj.setText(statusText);

function caxisSET(varargin)
global ax1 caxisMIN caxisMAX B1 cor
width=90; height=120; set(0, 'Units', 'points'); pos=get(0,'screensize');
fcaxis = figure('Units', 'points','WindowStyle', 'normal', ...
    'Position', [pos(3)/2-width/2 pos(4)/2-height/2 width height],'NumberTitle','off',...
    'Tag','ViewArea','Interruptible', 'off','menubar','none',...
    'DockControls', 'off','Visible','on','name','Bathymetry Limits','color',cor);
min_panel=uipanel('unit','normalized','parent',fcaxis','title','Minimum Value',...
    'position',[0.05 0.65 0.9 0.34],'titleposition','centertop');
caxisMIN=uicontrol('unit','normalized','parent',fcaxis,'style','edit','position',[0.18 0.72 0.64 0.14],...
    'string',sprintf('%3.1f',nanmin(B1(:))),'fontsize',9,'fontw','bold','horizontalalignment','right',...
    'backgroundcolor',[1 1 1]);
max_panel=uipanel('unit','normalized','parent',fcaxis','title','Maximum Value',...
    'position',[0.05 0.3 0.9 0.34],'titleposition','centertop');
caxisMAX=uicontrol('unit','normalized','parent',fcaxis,'style','edit','position',[0.18 0.37 0.64 0.14],...
    'string',sprintf('%3.1f',nanmax(B1(:))),'fontsize',9,'fontw','bold','horizontalalignment','right',...
    'backgroundcolor',[1 1 1]);
okbutton=uicontrol('unit','normalized','parent',fcaxis,'style','pushbutton',...
    'position',[0.05 0.05 0.9 0.2],'string','OK','fontsize',8,'horizontalalignment','center','callback',...
    'global ax1 caxisMIN caxisMAX; caxis(ax1,[str2num(get(caxisMIN,''string'')) str2num(get(caxisMAX,''string''))]);closereq');
modifyLogo(fcaxis);

function carregaLDB(varargin)
global ax1 PLOT_LDB LDB1
clear ldb
[file,path]=uigetfile({'*.ldb','Land Boundary (*.ldb)'},'Pick a File');
if file~=0
    ldb=readldb_CPE2([path,file]); aux00=find(ldb<1000);
    if ~isempty(aux00)
        ldb(aux00)=nan;
    end
    PLOT_LDB=plot(ax1,ldb(:,1),ldb(:,2),'color',[1 1 1],'linew',2); axis equal;
    LDB1=ldb;
end

function sel_color_LDB(varargin)
global PLOT_LDB LDB1
if ~isempty(LDB1)
    colors=uisetcolor;
    if colors~=0
        set(PLOT_LDB,'color',[colors(1) colors(2) colors(3)]);
    end
else
    MSG_ldb=msgbox('Set the Land Boundary Before','Xbeach GUI','warn');
    modifyLogo(MSG_ldb);
end

function sel_color_bg(varargin)
global fViewarea
colors=uisetcolor;
if colors~=0
    set(fViewarea,'color',[colors(1) colors(2) colors(3)]);
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                              Modify Logo                               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function modifyLogo(handlE,varargin)
import javax.swing.*
warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
jframe=get(handlE,'javaframe');
jIcon=javax.swing.ImageIcon('\\cpebrazilfs01\Apps\applications\CPE_tools\XBEACH_GUI\logos\X-FOFO-01.png');
jframe.setFigureIcon(jIcon);
% jframe.setImageIcon(jIcon);
% jframe.setUndecorated(true);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                            About Information                           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function aboutXbeachGUI(varargin)
width=250; height=150; set(0, 'Units', 'points'); screenSize = get(0,'ScreenSize');
pos1 = [screenSize(3)/2-width/2 screenSize(4)/2-height/2 width height];
aboutdiag=dialog('units','points','Name','About XBeach GUI','position',pos1,...
    'color',[1 1 1]);
modifyLogo(aboutdiag);
try
    myIcon = imread('\\cpebrazilfs01\Apps\Comunicao e Marketing\Logos\cbi-logo1.jpg');
catch
end
if exist('myIcon','var')
    jj=uicontrol('units','points','parent',aboutdiag,...
        'position',[width/2-80/2 90 80 50],'cdata',myIcon,'selected','off');
else
    jj=uicontrol('units','points','parent',aboutdiag,'style','text',...
        'position',[width/2-80/2 90 80 20],'string','CB&I','selected','off',...
        'fontsize',10,'fontw','bold','backgroundcolor',[1 1 1]);
end
uicontrol('units','points','parent',aboutdiag,'style','text','string','XBeach GUI',...
    'position',[width/2-100/2 50 100 20],'fontsize',10,'fontw','bold',...
    'horizontalalignment','center','backgroundcolor',[1 1 1]);
uicontrol('units','points','parent',aboutdiag,'style','text','string','Version: 1.0 by GHG',...
    'position',[width/2-100/2 20 100 20],'fontsize',10,'fontw','bold',...
    'horizontalalignment','center','backgroundcolor',[1 1 1]);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                              Close Figure                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function myclosereq(hObj,varargin)
global fViewarea saveF
newFile00;
waitfor(saveF,'name');
if ~isempty(fViewarea) & ishghandle(fViewarea)
    close(fViewarea);
end
% Call normal close request
closereq;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                             Splash Screen                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function splashXbeach(varargin)
global fh
mytimer = timerfind('Name','Splash') ;
if ~isempty(mytimer)
    stop  (mytimer);
    delete(mytimer)
    delete(fh);
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                              Alert Figure                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function alertFigure(message)
width=250; height=100; set(0, 'Units', 'points'); screenSize=get(0,'screensize');
pos1 = [screenSize(3)/2-width/2 screenSize(4)/2-height/2 width height];
alert=figure('unit','points','BusyAction','queue','WindowStyle','modal', ...
    'Position',pos1,'Resize','off','CreateFcn','','NumberTitle','off', ...
    'IntegerHandle','off','MenuBar','none','Tag','XbeachGUI','Interruptible','off', ...
    'DockControls','off','Visible','on','Interruptible','off','color',[1 1 1],'name','Xbeach GUI');
alertIcon=imread('f:\applications\CPE_tools\XBEACH_GUI\logos\Alert.png','backgroundcolor',[1 1 1]);
alertIconF=uicontrol('unit','normalized','cdata',alertIcon,...
    'position',[0.07 0.25 0.2 0.52]);
alertTXT=uicontrol('unit','normalized','style','text',...
    'string',message,'position',[0.32 0.5 0.63 0.3],...
    'fontsize',10,'fontw','bold','backgroundcolor',[1 1 1],'horizontalalignment','center');
alertOK=uicontrol('unit','normalized','style','pushbutton',...
    'string','Ok','position',[0.535 0.15 0.2 0.2],...
    'fontsize',10,'fontw','bold','callback','closereq');
modifyLogo(alert)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                              Figure title Size                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function titlesizeM=fsize(titlesize)
if ischar(titlesize) & length(titlesize) > 50
    titlesizeM=['... ',titlesize(end-50:end)];
else
    titlesizeM=titlesize;
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     Display Information Params file                    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function formText=dispSection(textSec,varargin)
baseT='%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%';
if length(textSec)~=0
    len01=length(textSec) + 4;
    t0=length(baseT) - len01;
    formText(1:round(t0/2))='%'; formText=[formText,'  ',textSec,'  ']; formText(end+1:length(baseT))='%';
else
    formText=baseT;
end

%                              Figure title Size                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                               Positions                                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [height,width]=positionsSafely(varargin)
oldRootUnits = get(0,'Units');
% Restore the Units safely
c = onCleanup(@()set(0, 'Units', oldRootUnits));
set(0, 'Units', 'normalized');
screenSize = get(0,'ScreenSize'); delete(c);
axFontSize=6; set(0,'ScreenPixelsPerInch',96);
pointsPerPixel = 72/get(0,'ScreenPixelsPerInch');
width = 800 * pointsPerPixel;
height = 600 * pointsPerPixel;
